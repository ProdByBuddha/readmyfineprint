"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3864],{36130:(e,t,a)=>{a.d(t,{xF:()=>d}),a(95155);var n=a(12115);a(97168),a(99840);var o=a(55411),s=a(73309);let r={necessary:!0,analytics:!1,marketing:!1},i=null,c=null,l=!1;function d(){let[e,t]=(0,n.useState)(!1),[a,d]=(0,n.useState)(!0),[u,g]=(0,n.useState)(0),{accepted:m,loading:f}=function(){let[e,t]=(0,n.useState)({accepted:!1,loading:!0,error:null}),a=(0,n.useCallback)(async()=>{try{if(!(document.cookie.includes("subscriptionToken")||document.cookie.includes("subscription_token")||localStorage.getItem("jwt_access_token")||localStorage.getItem("jwt_refresh_token")||localStorage.getItem("jwt_token")))try{let e=await (0,o.bl)("/api/auth/session",{method:"GET",credentials:"include"});if(e.ok){let t=await e.json();return t.authenticated&&t.user}e.status}catch(e){console.log("Session check failed, assuming unauthenticated:",e)}return!1}catch(e){return e instanceof Error&&!e.message.includes("401")&&console.warn("Failed to check authentication status:",e),!1}},[]),s=(0,n.useCallback)(async()=>{try{let e=await (0,o.bl)("/api/user/preferences/legal-disclaimer",{method:"GET",credentials:"include"});if(e.ok)return(await e.json()).accepted;return 401===e.status||429===e.status&&console.log("Rate limited loading disclaimer from database, using localStorage"),null}catch(e){return e instanceof Error&&!e.message.includes("401")&&console.warn("Failed to load legal disclaimer from database:",e),null}},[]),r=(0,n.useCallback)(async e=>{try{let t=await (0,o.bl)("/api/user/preferences/legal-disclaimer",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({accepted:e})});if(!t.ok){if(429===t.status)return console.log("Rate limited saving disclaimer to database, saved to localStorage only"),!0;if(401===t.status)return!0;throw Error("Failed to save legal disclaimer to database")}return!0}catch(e){return console.warn("Failed to save legal disclaimer to database:",e),!1}},[]),i=(0,n.useCallback)(async()=>{if(!e.loading){t(e=>({...e,loading:!0,error:null}));try{if(await a()){let e=await s();if(null!==e)t(t=>({...t,accepted:e,loading:!1}));else{let e="true"===localStorage.getItem("readmyfineprint-disclaimer-accepted");e&&await r(e)&&console.log("✅ Legal disclaimer acceptance migrated to database:",e),t(t=>({...t,accepted:e,loading:!1}))}}else{let e="true"===localStorage.getItem("readmyfineprint-disclaimer-accepted");t(t=>({...t,accepted:e,loading:!1}))}}catch(a){console.error("Failed to initialize legal disclaimer:",a);let e="true"===localStorage.getItem("readmyfineprint-disclaimer-accepted");t(t=>({...t,accepted:e,loading:!1,error:"Failed to sync with database, using local storage"}))}}},[a,s,r]),c=(0,n.useCallback)(async()=>{t(e=>({...e,accepted:!0}));let e=new Date().toISOString();localStorage.setItem("readmyfineprint-disclaimer-accepted","true"),localStorage.setItem("readmyfineprint-disclaimer-date",e);try{await a()&&(await r(!0)||t(e=>({...e,error:"Failed to sync disclaimer acceptance to database"})))}catch(e){console.warn("Failed to save disclaimer acceptance:",e),t(e=>({...e,error:"Disclaimer saved locally but failed to sync to database"}))}},[a,r]),l=(0,n.useCallback)(async()=>{t(e=>({...e,accepted:!1})),localStorage.removeItem("readmyfineprint-disclaimer-accepted"),localStorage.removeItem("readmyfineprint-disclaimer-date");try{await a()&&(await r(!1)||t(e=>({...e,error:"Failed to sync disclaimer revocation to database"})))}catch(e){console.warn("Failed to revoke disclaimer:",e),t(e=>({...e,error:"Disclaimer revoked locally but failed to sync to database"}))}},[a,r]);return(0,n.useEffect)(()=>{(async()=>{i()})()},[i]),(0,n.useEffect)(()=>{let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{i()},1e3)};return window.addEventListener("authStateChanged",t),window.addEventListener("authUpdate",t),()=>{clearTimeout(e),window.removeEventListener("authStateChanged",t),window.removeEventListener("authUpdate",t)}},[i]),{accepted:e.accepted,loading:e.loading,error:e.error,acceptDisclaimer:c,revokeDisclaimer:l}}(),{isAccepted:p,loading:w}=function(){let[e,t]=(0,n.useState)({settings:r,isAccepted:!1,loading:!0,error:null}),a=(0,n.useCallback)(async()=>{try{let e=await (0,o.bl)("/api/auth/session",{method:"GET",credentials:"include"});if(e.ok){let t=await e.json();return t.authenticated&&t.user}return!1}catch(e){return console.warn("Failed to check authentication status:",e),!1}},[]),s=(0,n.useCallback)(async()=>{try{let e=await (0,o.bl)("/api/user/preferences/cookie-consent",{method:"GET",credentials:"include"});if(e.ok)return(await e.json()).cookieConsent;return null}catch(e){return console.warn("Failed to load cookie consent from database:",e),null}},[]),i=(0,n.useCallback)(async e=>{try{if(!(await (0,o.bl)("/api/user/preferences/cookie-consent",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})).ok)throw Error("Failed to save cookie consent to database");return!0}catch(e){return console.warn("Failed to save cookie consent to database:",e),!1}},[]),c=(0,n.useCallback)(()=>{try{let e="true"===localStorage.getItem("cookie-consent-accepted"),t=localStorage.getItem("cookie-consent-settings"),a=r;if(t)try{a=JSON.parse(t)}catch(e){console.warn("Failed to parse stored cookie settings:",e)}return{accepted:e,settings:a}}catch(e){return console.warn("Failed to read localStorage cookie consent:",e),{accepted:!1,settings:r}}},[]),l=(0,n.useCallback)((e,t)=>{try{localStorage.setItem("cookie-consent-accepted",t.toString()),localStorage.setItem("cookie-consent-settings",JSON.stringify(e))}catch(e){console.warn("Failed to save to localStorage:",e)}},[]),d=(0,n.useCallback)(async()=>{t(e=>({...e,loading:!0,error:null}));try{if(await a()){let e=await s();if(e){let a=e.necessary||e.analytics||e.marketing;t(t=>({...t,settings:e,isAccepted:a,loading:!1}))}else{let{accepted:e,settings:a}=c();e&&await i(a)&&console.log("✅ Cookie consent migrated to database:",a),t(t=>({...t,settings:a,isAccepted:e,loading:!1}))}}else{let{accepted:e,settings:a}=c();t(t=>({...t,settings:a,isAccepted:e,loading:!1}))}}catch(n){console.error("Failed to initialize cookie consent:",n);let{accepted:e,settings:a}=c();t(t=>({...t,settings:a,isAccepted:e,loading:!1,error:"Failed to sync with database, using local storage"}))}},[a,s,i,c]),u=(0,n.useCallback)(async()=>{let e={necessary:!0,analytics:!0,marketing:!0};t(t=>({...t,settings:e,isAccepted:!0})),l(e,!0);try{await a()&&(await i(e)||t(e=>({...e,error:"Failed to sync cookie consent to database"})))}catch(e){console.warn("Failed to save cookie consent:",e),t(e=>({...e,error:"Cookie consent saved locally but failed to sync to database"}))}window.dispatchEvent(new CustomEvent("consentChanged"))},[a,i,l]),g=(0,n.useCallback)(async e=>{let n=e.necessary||e.analytics||e.marketing;t(t=>({...t,settings:e,isAccepted:n})),l(e,n);try{await a()&&(await i(e)||t(e=>({...e,error:"Failed to sync cookie consent to database"})))}catch(e){console.warn("Failed to save cookie consent:",e),t(e=>({...e,error:"Cookie consent saved locally but failed to sync to database"}))}window.dispatchEvent(new CustomEvent("consentChanged"))},[a,i,l]),m=(0,n.useCallback)(async()=>{let e={necessary:!0,analytics:!1,marketing:!1};t(t=>({...t,settings:e,isAccepted:!1})),localStorage.removeItem("cookie-consent-accepted"),localStorage.removeItem("cookie-consent-settings");try{await a()&&(await i(e)||t(e=>({...e,error:"Failed to sync cookie revocation to database"})))}catch(e){console.warn("Failed to revoke cookies:",e),t(e=>({...e,error:"Cookies revoked locally but failed to sync to database"}))}window.dispatchEvent(new CustomEvent("consentRevoked"))},[a,i]);return(0,n.useEffect)(()=>{d()},[d]),(0,n.useEffect)(()=>{let e=()=>{d()};return window.addEventListener("authStateChanged",e),window.addEventListener("authUpdate",e),()=>{window.removeEventListener("authStateChanged",e),window.removeEventListener("authUpdate",e)}},[d]),{settings:e.settings,isAccepted:e.isAccepted,loading:e.loading,error:e.error,acceptAllCookies:u,acceptCookies:g,revokeCookies:m,hasAnalytics:e.settings.analytics,hasMarketing:e.settings.marketing,acceptAll:u,revokeConsent:m}}();(0,n.useEffect)(()=>{if(f||w)return void d(!0);let e=m&&p;t(e),d(!1),i={status:e,timestamp:Date.now(),sessionId:(0,s.lo)()}},[m,p,f,w]);let y=(0,n.useCallback)(async()=>{let e=Date.now();if(i&&e-i.timestamp<3e4){t(i.status),d(!1);return}if(l)return void console.log("Consent check already in progress, skipping...");l=!0,d(!0);try{(0,s.lo)();let a=await (0,s.bl)("/api/consent/verify",{method:"POST",headers:{"Content-Type":"application/json"}});if(a.ok){let n=await a.json(),o=!0===n.hasConsented;i={status:o,timestamp:e,sessionId:(0,s.lo)()},t(o),g(e=>e+1)}else console.warn("Consent check failed with status:",a.status),i={status:!1,timestamp:e},t(!1)}catch(e){console.warn("Failed to verify consent with database:",e),i=null,t(!1)}finally{l=!1,d(!1)}},[]);(0,n.useEffect)(()=>{let e;(async()=>{let e=(0,s.lo)();if(i&&i.sessionId===e&&Date.now()-i.timestamp<3e4){t(i.status),d(!1);return}await y()})();let a=()=>{i=null,clearTimeout(e),e=window.setTimeout(()=>{console.log("Handling consent change - rechecking consent"),y()},100)},n=()=>{i=null,t(!1),d(!1),console.log("Consent revoked - enabling gray mode"),setTimeout(()=>{console.log("Re-checking consent after revocation"),y(),g(e=>e+1)},100)};return window.addEventListener("consentChanged",a),window.addEventListener("consentRevoked",n),()=>{clearTimeout(e),window.removeEventListener("consentChanged",a),window.removeEventListener("consentRevoked",n)}},[]);let h=async()=>{if(!a){d(!0);try{let e=await (0,o.rh)();if(!e.success){console.warn("Consent logging warning:",e.message),t(!1),d(!1);return}i={status:!0,timestamp:Date.now(),sessionId:(0,s.lo)()},window.dispatchEvent(new CustomEvent("consentChanged")),t(!0),d(!1),g(e=>e+1),console.log("Consent accepted successfully"),c&&clearTimeout(c),c=window.setTimeout(()=>{},2e3)}catch(e){console.warn("Consent logging failed:",e),t(!1),d(!1);return}}},k=async()=>{if(!a){d(!0);try{let e=(0,s.lo)();console.log("Revoking consent with session: ".concat(e.substring(0,16),"..."));let a=await (0,s.bl)("/api/consent/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:"client-side-revoke",userAgent:navigator.userAgent})}),n=await a.json();n.success||console.warn("Failed to revoke consent in database:",n.message),i=null,t(!1),d(!1),c&&clearTimeout(c),g(e=>e+1),window.dispatchEvent(new CustomEvent("consentRevoked"))}catch(e){console.warn("Failed to revoke consent from database:",e),i=null,t(!1),d(!1),c&&clearTimeout(c),window.dispatchEvent(new CustomEvent("consentRevoked"))}}};return{isAccepted:e,isCheckingConsent:a,acceptAll:h,revokeConsent:k,forceUpdate:u}}},88145:(e,t,a)=>{a.d(t,{E:()=>i});var n=a(95155);a(12115);var o=a(74466),s=a(53999);let r=(0,o.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...o}=e;return(0,n.jsx)("div",{className:(0,s.cn)(r({variant:a}),t),...o})}},99840:(e,t,a)=>{a.d(t,{Cf:()=>u,L3:()=>m,c7:()=>g,lG:()=>c,rr:()=>f});var n=a(95155),o=a(12115),s=a(15452),r=a(54416),i=a(53999);let c=s.bL;s.l9;let l=s.ZL;s.bm;let d=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(s.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...o})});d.displayName=s.hJ.displayName;let u=o.forwardRef((e,t)=>{let{className:a,children:o,hideCloseButton:c,...u}=e;return(0,n.jsxs)(l,{children:[(0,n.jsx)(d,{}),(0,n.jsxs)(s.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...u,children:[o,!c&&(0,n.jsxs)(s.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-all hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 w-6 h-6 flex items-center justify-center",children:[(0,n.jsx)(r.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=s.UC.displayName;let g=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};g.displayName="DialogHeader";let m=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(s.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...o})});m.displayName=s.hE.displayName;let f=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(s.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...o})});f.displayName=s.VY.displayName}}]);