"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8891],{53999:(e,t,r)=>{r.d(t,{cn:()=>n});var s=r(52596),o=r(39688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,s.$)(t))}},73309:(e,t,r)=>{r.d(t,{bl:()=>c,lo:()=>a,q7:()=>l});var s=r(74671);let o=null;function n(){return crypto.getRandomValues(new Uint8Array(16)).reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")}function a(){return o||(o=sessionStorage.getItem("app-session-id")||n(),sessionStorage.setItem("app-session-id",o)),o}function i(e){o=e,sessionStorage.setItem("app-session-id",e)}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a();if(!["GET","HEAD","OPTIONS"].includes((t.method||"GET").toUpperCase())){let o={...t.headers||{},"x-session-id":r},n=localStorage.getItem("jwt_access_token");n||(n=sessionStorage.getItem("jwt_access_token")),n&&(o.Authorization="Bearer ".concat(n));let a=await (0,s.fd)(e,{...t,headers:o});if(401===a.status&&n&&localStorage.getItem("jwt_refresh_token"))try{let r=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:localStorage.getItem("jwt_refresh_token")}),credentials:"include"});if(r.ok){let n=r.headers.get("content-type");if(n&&n.includes("application/json")){let{tokens:n}=await r.json();localStorage.setItem("jwt_access_token",n.access),localStorage.setItem("jwt_refresh_token",n.refresh),sessionStorage.setItem("jwt_access_token",n.access),sessionStorage.setItem("jwt_refresh_token",n.refresh);let a={...o,Authorization:"Bearer ".concat(n.access)};return(0,s.fd)(e,{...t,headers:a})}}}catch(e){console.log("Token refresh failed for CSRF request:",e instanceof Error?e.message:"Unknown error"),localStorage.removeItem("jwt_access_token"),localStorage.removeItem("jwt_refresh_token")}return a}let o={...t.headers||{},"x-session-id":r},n=localStorage.getItem("jwt_access_token");n&&(o.Authorization="Bearer ".concat(n));let c=await fetch(e,{...t,headers:o,credentials:"include"});if(401===c.status&&n&&localStorage.getItem("jwt_refresh_token"))try{let r=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:localStorage.getItem("jwt_refresh_token")}),credentials:"include"});if(r.ok){let s=r.headers.get("content-type");if(s&&s.includes("application/json")){let{tokens:s}=await r.json();localStorage.setItem("jwt_access_token",s.access),localStorage.setItem("jwt_refresh_token",s.refresh);let n={...o,Authorization:"Bearer ".concat(s.access)};return fetch(e,{...t,headers:n,credentials:"include"})}console.warn("Refresh endpoint returned non-JSON response")}else console.log("Token refresh failed with status:",r.status)}catch(e){console.log("Token refresh failed:",e instanceof Error?e.message:"Unknown error"),localStorage.removeItem("jwt_access_token"),localStorage.removeItem("jwt_refresh_token")}else c.status;let l=c.headers.get("x-session-id");return l&&l!==r&&i(l),c}function l(){o=null,sessionStorage.removeItem("app-session-id"),localStorage.removeItem("jwt_access_token"),localStorage.removeItem("jwt_refresh_token"),sessionStorage.removeItem("jwt_access_token"),sessionStorage.removeItem("jwt_refresh_token"),sessionStorage.removeItem("readmyfineprint-consent-id"),sessionStorage.removeItem("readmyfineprint-verification-token"),sessionStorage.clear(),localStorage.removeItem("subscriptionToken"),localStorage.removeItem("subscription_token"),localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),i(n())}},74671:(e,t,r)=>{r.d(t,{LF:()=>a,fd:()=>n});class s{async getToken(e){if(this.token&&Date.now()<this.tokenExpiry)return this.token;if(this.fetchPromise)try{return await this.fetchPromise}catch(e){throw this.fetchPromise=null,e}this.fetchPromise=this.fetchTokenFromServer(e);try{let e=await this.fetchPromise;return this.fetchPromise=null,e}catch(e){throw this.fetchPromise=null,e}}async fetchTokenFromServer(e){try{let t=await fetch("/api/csrf-token",{method:"GET",headers:{"Content-Type":"application/json","x-session-id":e},credentials:"include"});if(!t.ok)throw Error("Failed to fetch CSRF token: ".concat(t.status));let r=await t.json();if(!r.csrfToken)throw Error("No CSRF token received from server");return this.token=r.csrfToken,this.tokenExpiry=Date.now()+this.TOKEN_VALIDITY,r.csrfToken}catch(e){throw e}}async addTokenToHeaders(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=await this.getToken(e);return{...t,"x-csrf-token":r}}catch(e){return t}}async fetch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;if(["GET","HEAD","OPTIONS"].includes((t.method||"GET").toUpperCase()))return fetch(e,{...t,credentials:"include"});try{let s=await this.addTokenToHeaders(r,t.headers||{}),o=await fetch(e,{...t,headers:s,credentials:"include"});if(403===o.status){let s=await o.text();if(s.includes("CSRF")||s.includes("csrf")){this.clearToken();let s=await this.addTokenToHeaders(r,t.headers||{});return fetch(e,{...t,headers:s,credentials:"include"})}}return o}catch(e){throw e}}clearToken(){this.token=null,this.tokenExpiry=0,this.fetchPromise=null}hasValidToken(){return null!==this.token&&Date.now()<this.tokenExpiry}getCurrentToken(){return this.token}constructor(){this.token=null,this.tokenExpiry=0,this.TOKEN_VALIDITY=9e6,this.fetchPromise=null}}let o=new s;async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=sessionStorage.getItem("app-session-id")||"anonymous";return o.fetch(e,t,r)}function a(){o.clearToken()}},88482:(e,t,r)=>{r.d(t,{BT:()=>l,Wu:()=>d,ZB:()=>c,Zp:()=>a,aR:()=>i,wL:()=>h});var s=r(95155),o=r(12115),n=r(53999);let a=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...o})});a.displayName="Card";let i=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...o})});i.displayName="CardHeader";let c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...o})});c.displayName="CardTitle";let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...o})});l.displayName="CardDescription";let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...o})});d.displayName="CardContent";let h=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...o})});h.displayName="CardFooter"},97168:(e,t,r)=>{r.d(t,{$:()=>l});var s=r(95155),o=r(12115),n=r(99708),a=r(74466),i=r(53999);let c=(0,a.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2 min-w-[2.5rem]",sm:"h-9 rounded-md px-3 min-w-[2.25rem]",lg:"h-11 rounded-md px-8 min-w-[2.75rem]",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=o.forwardRef((e,t)=>{let{className:r,variant:o,size:a,asChild:l=!1,loading:d=!1,disabled:h,children:f,...u}=e,m=l?n.DX:"button",g=h||d;return(0,s.jsxs)(m,{className:(0,i.cn)(c({variant:o,size:a,className:r})),ref:t,disabled:g,"aria-disabled":g,"aria-busy":d,tabIndex:g?-1:0,...u,children:[d&&(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),f,d&&(0,s.jsx)("span",{className:"sr-only",children:"Loading..."})]})});l.displayName="Button"}}]);