"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5411],{6069:(e,r,t)=>{function o(){let e=sessionStorage.getItem("app-session-id");return e||(e=crypto.getRandomValues(new Uint8Array(16)).reduce((e,r)=>e+r.toString(16).padStart(2,"0"),""),sessionStorage.setItem("app-session-id",e),console.log("Generated new session ID:",e)),e}function a(e){let r=sessionStorage.getItem("app-session-id");e&&e!==r&&(sessionStorage.setItem("app-session-id",e),console.log("Updated session ID:",e))}function s(e){return 403===e.status}function n(){window.dispatchEvent(new CustomEvent("consentRequired",{detail:{reason:"API request blocked - consent required"}}))}async function i(e){if(!e.ok){let r=await e.text()||e.statusText;if(s(e))try{let e=JSON.parse(r);"CONSENT_REQUIRED"===e.code&&n()}catch(e){n()}throw Error("".concat(e.status,": ").concat(r))}}async function c(e,r,t){let i=(null==t?void 0:t.headers)||{},c={"x-session-id":o(),...i};(null==t?void 0:t.body)&&(c["Content-Type"]="application/json");let l=await fetch(r,{method:e,headers:c,body:(null==t?void 0:t.body)?JSON.stringify(t.body):void 0,credentials:"include"}),d=l.headers.get("x-session-id");if(d&&a(d),!l.ok){let e=await l.text();if(s(l))try{let r=JSON.parse(e);"CONSENT_REQUIRED"===r.code&&n()}catch(e){n()}throw Error("HTTP ".concat(l.status,": ").concat(e))}return l}t.d(r,{AT:()=>c,qQ:()=>l});let l=new(t(87017)).E({defaultOptions:{queries:{queryFn:(e=>{let{on401:r}=e;return async e=>{let{queryKey:t}=e,c=await fetch(t[0],{headers:{"x-session-id":o()},credentials:"include"}),l=c.headers.get("x-session-id");if(l&&a(l),"returnNull"===r&&401===c.status)return null;if(s(c)){let e=await c.text();try{let r=JSON.parse(e);"CONSENT_REQUIRED"===r.code&&n()}catch(e){n()}throw Error("HTTP ".concat(c.status,": ").concat(e))}return await i(c),await c.json()}})({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,refetchIntervalInBackground:!1,notifyOnChangeProps:["data","error"],staleTime:1/0,gcTime:864e5,retry:!1,structuralSharing:!1},mutations:{retry:!1,onError:e=>{var r,t;(null==e||null==(r=e.message)?void 0:r.includes("403"))&&(null==e||null==(t=e.message)?void 0:t.includes("CONSENT_REQUIRED"))&&(console.log("Mutation error indicates consent required, triggering consent modal"),n())}}}})},55411:(e,r,t)=>{t.d(r,{IG:()=>p,de:()=>g,ui:()=>c,gP:()=>E,YE:()=>y,c1:()=>w,Sf:()=>d,Vl:()=>u,rh:()=>f,ri:()=>m,bl:()=>a.bl,x0:()=>h,Zh:()=>T,XX:()=>l});var o=t(6069),a=t(73309),s=t(74671);class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}setupGlobalErrorHandlers(){window.addEventListener("error",e=>{var r;this.reportError({errorType:"frontend",severity:"high",message:e.message,stack:null==(r=e.error)?void 0:r.stack,url:e.filename,additionalContext:{lineno:e.lineno,colno:e.colno,globalError:!0}})}),window.addEventListener("unhandledrejection",e=>{var r;this.reportError({errorType:"frontend",severity:"high",message:"Unhandled promise rejection: ".concat(e.reason),stack:null==(r=e.reason)?void 0:r.stack,additionalContext:{promiseRejection:!0,reason:e.reason}})})}async reportApiError(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",o=this.determineSeverity(e);await this.reportError({errorType:"api",severity:o,message:"API Error: ".concat(e.message||e.toString()),stack:e.stack,additionalContext:{endpoint:r,method:t,status:e.status,statusText:e.statusText,apiError:!0}})}async reportNetworkError(e,r){await this.reportError({errorType:"network",severity:"medium",message:"Network Error: ".concat(e.message||"Connection failed"),additionalContext:{url:r,networkError:!0}})}async reportAuthError(e,r){await this.reportError({errorType:"authentication",severity:"medium",message:"Auth Error: ".concat(e),additionalContext:{...r,authError:!0}})}async reportError(e){if(this.isEnabled)try{let o,a=this.createErrorHash(e);if(this.reportedErrors.has(a))return;if(this.reportedErrors.add(a),this.reportedErrors.size>100){let e=Array.from(this.reportedErrors);this.reportedErrors=new Set(e.slice(-50))}let s={...e,url:e.url||window.location.href,additionalContext:{...e.additionalContext,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),screenSize:"".concat(window.screen.width,"x").concat(window.screen.height),viewportSize:"".concat(window.innerWidth,"x").concat(window.innerHeight)}},n=0;for(;n<3;){try{let e=await fetch("/api/errors/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),credentials:"include",signal:AbortSignal.timeout(1e4)});if(e.ok)return void console.log("Error reported to admin successfully");console.warn("Failed to report error to admin:",e.status),o=Error("HTTP ".concat(e.status))}catch(e){var r,t;if(o=e,console.warn("Error reporting attempt ".concat(n+1," failed:"),e.message),!(null==(r=e.message)?void 0:r.includes("fetch"))&&!(null==(t=e.name)?void 0:t.includes("Abort")))break}++n<3&&await new Promise(e=>setTimeout(e,1e3*Math.pow(2,n-1)))}console.error("Failed to report error after all attempts:",o)}catch(e){console.error("Error reporting failed:",e)}}determineSeverity(e){var r,t,o,a;return 401===e.status||403===e.status?"medium":e.status>=500?"high":(null==(r=e.message)?void 0:r.includes("Network Error"))||(null==(t=e.message)?void 0:t.includes("Failed to fetch"))?"medium":(null==(o=e.message)?void 0:o.includes("TypeError"))||(null==(a=e.message)?void 0:a.includes("ReferenceError"))?"high":"medium"}createErrorHash(e){return btoa("".concat(e.errorType,":").concat(e.message,":").concat(e.url)).substring(0,16)}setEnabled(e){this.isEnabled=e}async reportCriticalError(e,r){await this.reportError({errorType:"frontend",severity:"critical",message:e,additionalContext:{...r,critical:!0}})}constructor(){this.isEnabled=!0,this.reportedErrors=new Set,this.setupGlobalErrorHandlers()}}let i=n.getInstance();async function c(e){let r=await (0,a.bl)("/api/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e,t="Failed to create document: ".concat(r.statusText);try{let e=await r.text();try{let r=JSON.parse(e);r.error&&(t=r.error)}catch(r){e.includes("<!DOCTYPE")?t="Server error occurred. Please refresh the page and try again.":e&&(t=e)}}catch(e){console.error("Failed to read error response:",e)}throw e=Error(t),i.reportApiError(e,"/api/documents","POST"),Error(t)}try{let e=await r.text();return JSON.parse(e)}catch(e){throw console.error("Failed to parse JSON response:",e),Error("Server returned invalid response. Please refresh the page and try again.")}}async function l(e){let r=new FormData;r.append("file",e);let t=await (0,a.bl)("/api/documents/upload",{method:"POST",body:r});if(!t.ok)try{let e=await t.text();try{let r=JSON.parse(e);throw Error(r.error||e)}catch(r){throw Error(e||"Upload failed: ".concat(t.statusText))}}catch(e){throw Error("Upload failed: ".concat(t.statusText))}try{return await t.json()}catch(e){throw console.error("Failed to parse upload response:",e),Error("Server returned invalid response. Please try again.")}}async function d(){let e=await fetch("/api/security-questions/available",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)try{let r=await e.text();try{let t=JSON.parse(r);throw Error(t.error||"HTTP error! status: ".concat(e.status))}catch(t){throw Error(r||"HTTP error! status: ".concat(e.status))}}catch(r){throw Error("HTTP error! status: ".concat(e.status))}try{return await e.json()}catch(e){throw console.error("Failed to parse security questions response:",e),Error("Server returned invalid response. Please try again.")}}async function u(){let e=await fetch("/api/security-questions/user",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)try{let r=await e.text();try{let t=JSON.parse(r);throw Error(t.error||"HTTP error! status: ".concat(e.status))}catch(t){throw Error(r||"HTTP error! status: ".concat(e.status))}}catch(r){throw Error("HTTP error! status: ".concat(e.status))}try{return await e.json()}catch(e){throw console.error("Failed to parse getUserSecurityQuestions response:",e),Error("Server returned invalid response. Please try again.")}}async function h(e){let r=await (0,s.fd)("/api/security-questions/setup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)try{let e=await r.text();try{let t=JSON.parse(e);throw Error(t.error||"HTTP error! status: ".concat(r.status))}catch(t){throw Error(e||"HTTP error! status: ".concat(r.status))}}catch(e){throw Error("HTTP error! status: ".concat(r.status))}try{return await r.json()}catch(e){throw console.error("Failed to parse setupSecurityQuestions response:",e),Error("Server returned invalid response. Please try again.")}}async function p(e){let r={},t=localStorage.getItem("deviceFingerprint");t&&(r["x-device-fingerprint"]=t);let a=await (0,o.AT)("POST","/api/documents/".concat(e,"/analyze"),{headers:r});if(!a.ok)try{let e=await a.text();try{let r=JSON.parse(e);throw Error(r.error||"Failed to analyze document")}catch(r){throw Error(e||"Failed to analyze document")}}catch(e){throw Error("Failed to analyze document")}try{return await a.json()}catch(e){throw console.error("Failed to parse analyzeDocument response:",e),Error("Server returned invalid response. Please try again.")}}async function w(){let e=await (0,a.bl)("/api/queue/status",{method:"GET"});if(!e.ok)try{let r=await e.text();throw Error("HTTP ".concat(e.status,": ").concat(r))}catch(r){throw Error("HTTP ".concat(e.status,": ").concat(e.statusText))}try{return await e.json()}catch(e){throw console.error("Failed to parse getQueueStatus response:",e),Error("Server returned invalid response. Please try again.")}}async function y(e){let r=await (0,a.bl)("/api/documents/".concat(e),{method:"GET",credentials:"include"});if(!r.ok)try{let e=await r.text();try{let r=JSON.parse(e);throw Error(r.error||"Failed to fetch document")}catch(r){throw Error(e||"Failed to fetch document")}}catch(e){throw Error("Failed to fetch document")}try{return await r.json()}catch(e){throw console.error("Failed to parse getDocument response:",e),Error("Server returned invalid response. Please try again.")}}async function E(){let e=await (0,a.bl)("/api/documents",{method:"GET",credentials:"include"});if(!e.ok)try{let r=await e.text();try{let e=JSON.parse(r);throw Error(e.error||"Failed to fetch documents")}catch(e){throw Error(r||"Failed to fetch documents")}}catch(e){throw Error("Failed to fetch documents")}try{return await e.json()}catch(e){throw console.error("Failed to parse getAllDocuments response:",e),Error("Server returned invalid response. Please try again.")}}async function g(){let e=await (0,a.bl)("/api/documents",{method:"DELETE",headers:{}});if(!e.ok)try{let r=await e.text();try{let e=JSON.parse(r);throw Error(e.error||"Failed to clear documents")}catch(e){throw Error(r||"Failed to clear documents")}}catch(e){throw Error("Failed to clear documents")}try{return await e.json()}catch(e){throw console.error("Failed to parse clearAllDocuments response:",e),Error("Server returned invalid response. Please try again.")}}async function f(){try{let e=(0,a.lo)();console.log("API: Logging consent with session: ".concat(e.substring(0,16),"..."));let r=await (0,a.bl)("/api/consent",{method:"POST",headers:{"Content-Type":"application/json"}});if(!r.ok)try{let e=await r.text();try{let r=JSON.parse(e);throw Error(r.error||"Failed to log consent")}catch(r){throw Error(e||"Failed to log consent")}}catch(e){throw Error("Failed to log consent")}try{return await r.json()}catch(e){throw console.error("Failed to parse logConsent response:",e),Error("Server returned invalid response. Please try again.")}}catch(e){return console.warn("Consent logging failed:",e),{success:!1,message:"Consent logging failed, but you can continue using the service"}}}async function m(){try{let e,r=await (0,s.fd)("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!r.ok)try{let e=await r.text();try{let r=JSON.parse(e);throw Error(r.error||"Logout request failed")}catch(r){throw Error(e||"Logout request failed")}}catch(e){throw Error("Logout request failed")}try{e=await r.json()}catch(r){console.error("Failed to parse logout response:",r),e={success:!0,message:"Logout successful (response parse failed)",details:{tokensRevoked:0,documentsCleared:!0,sessionCleared:!0}}}return localStorage.removeItem("subscriptionToken"),(0,a.q7)(),console.log("\uD83D\uDEAA Logout successful:",e),e}catch(e){return console.error("Failed to logout:",e),localStorage.removeItem("subscriptionToken"),(0,a.q7)(),{success:!1,message:"Logout completed locally (server cleanup may have failed)",details:{tokensRevoked:0,documentsCleared:!1,sessionCleared:!0}}}}async function T(e){let r=(0,a.lo)(),t=await (0,s.fd)("/api/rlhf/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,sessionId:r})});if(!t.ok){let e="Failed to submit feedback: ".concat(t.statusText);try{let r=await t.text();try{let t=JSON.parse(r);t.error&&(e=t.error)}catch(t){r&&(e=r)}}catch(e){}throw Error(e)}try{return await t.json()}catch(e){throw console.error("Failed to parse submitPiiDetectionFeedback response:",e),Error("Server returned invalid response. Please try again.")}}}}]);