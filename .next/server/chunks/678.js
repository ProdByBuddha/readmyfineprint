"use strict";exports.id=678,exports.ids=[678],exports.modules={37826:(a,b,c)=>{c.d(b,{Cf:()=>l,L3:()=>n,c7:()=>m,lG:()=>i,rr:()=>o});var d=c(60687),e=c(43210),f=c(26134),g=c(11860),h=c(96241);let i=f.bL;f.l9;let j=f.ZL;f.bm;let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.hJ,{ref:c,className:(0,h.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...b}));k.displayName=f.hJ.displayName;let l=e.forwardRef(({className:a,children:b,hideCloseButton:c,...e},i)=>(0,d.jsxs)(j,{children:[(0,d.jsx)(k,{}),(0,d.jsxs)(f.UC,{ref:i,className:(0,h.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...e,children:[b,!c&&(0,d.jsxs)(f.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-all hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 w-6 h-6 flex items-center justify-center",children:[(0,d.jsx)(g.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));l.displayName=f.UC.displayName;let m=({className:a,...b})=>(0,d.jsx)("div",{className:(0,h.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...b});m.displayName="DialogHeader";let n=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.hE,{ref:c,className:(0,h.cn)("text-lg font-semibold leading-none tracking-tight",a),...b}));n.displayName=f.hE.displayName;let o=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.VY,{ref:c,className:(0,h.cn)("text-sm text-muted-foreground",a),...b}));o.displayName=f.VY.displayName},59821:(a,b,c)=>{c.d(b,{E:()=>h});var d=c(60687);c(43210);var e=c(24224),f=c(96241);let g=(0,e.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800"}},defaultVariants:{variant:"default"}});function h({className:a,variant:b,...c}){return(0,d.jsx)("div",{className:(0,f.cn)(g({variant:b}),a),...c})}},82972:(a,b,c)=>{c.d(b,{xF:()=>k}),c(60687);var d=c(43210);c(24934),c(37826);var e=c(4462),f=c(35201);let g={necessary:!0,analytics:!1,marketing:!1},h=null,i=null,j=!1;function k(){let[a,b]=(0,d.useState)(!1),[c,k]=(0,d.useState)(!0),[l,m]=(0,d.useState)(0),{accepted:n,loading:o}=function(){let[a,b]=(0,d.useState)({accepted:!1,loading:!0,error:null}),c=(0,d.useCallback)(async()=>{try{if(!(document.cookie.includes("subscriptionToken")||document.cookie.includes("subscription_token")||localStorage.getItem("jwt_access_token")||localStorage.getItem("jwt_refresh_token")||localStorage.getItem("jwt_token")))try{let a=await (0,e.bl)("/api/auth/session",{method:"GET",credentials:"include"});if(a.ok){let b=await a.json();return b.authenticated&&b.user}a.status}catch(a){console.log("Session check failed, assuming unauthenticated:",a)}return!1}catch(a){return a instanceof Error&&!a.message.includes("401")&&console.warn("Failed to check authentication status:",a),!1}},[]),f=(0,d.useCallback)(async()=>{try{let a=await (0,e.bl)("/api/user/preferences/legal-disclaimer",{method:"GET",credentials:"include"});if(a.ok)return(await a.json()).accepted;return 401===a.status||429===a.status&&console.log("Rate limited loading disclaimer from database, using localStorage"),null}catch(a){return a instanceof Error&&!a.message.includes("401")&&console.warn("Failed to load legal disclaimer from database:",a),null}},[]),g=(0,d.useCallback)(async a=>{try{let b=await (0,e.bl)("/api/user/preferences/legal-disclaimer",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({accepted:a})});if(!b.ok){if(429===b.status)return console.log("Rate limited saving disclaimer to database, saved to localStorage only"),!0;if(401===b.status)return!0;throw Error("Failed to save legal disclaimer to database")}return!0}catch(a){return console.warn("Failed to save legal disclaimer to database:",a),!1}},[]);(0,d.useCallback)(async()=>{if(!a.loading){b(a=>({...a,loading:!0,error:null}));try{if(await c()){let a=await f();if(null!==a)b(b=>({...b,accepted:a,loading:!1}));else{let a="true"===localStorage.getItem("readmyfineprint-disclaimer-accepted");a&&await g(a)&&console.log("✅ Legal disclaimer acceptance migrated to database:",a),b(b=>({...b,accepted:a,loading:!1}))}}else{let a="true"===localStorage.getItem("readmyfineprint-disclaimer-accepted");b(b=>({...b,accepted:a,loading:!1}))}}catch(c){console.error("Failed to initialize legal disclaimer:",c);let a="true"===localStorage.getItem("readmyfineprint-disclaimer-accepted");b(b=>({...b,accepted:a,loading:!1,error:"Failed to sync with database, using local storage"}))}}},[c,f,g]);let h=(0,d.useCallback)(async()=>{b(a=>({...a,accepted:!0}));let a=new Date().toISOString();localStorage.setItem("readmyfineprint-disclaimer-accepted","true"),localStorage.setItem("readmyfineprint-disclaimer-date",a);try{await c()&&(await g(!0)||b(a=>({...a,error:"Failed to sync disclaimer acceptance to database"})))}catch(a){console.warn("Failed to save disclaimer acceptance:",a),b(a=>({...a,error:"Disclaimer saved locally but failed to sync to database"}))}},[c,g]),i=(0,d.useCallback)(async()=>{b(a=>({...a,accepted:!1})),localStorage.removeItem("readmyfineprint-disclaimer-accepted"),localStorage.removeItem("readmyfineprint-disclaimer-date");try{await c()&&(await g(!1)||b(a=>({...a,error:"Failed to sync disclaimer revocation to database"})))}catch(a){console.warn("Failed to revoke disclaimer:",a),b(a=>({...a,error:"Disclaimer revoked locally but failed to sync to database"}))}},[c,g]);return{accepted:a.accepted,loading:a.loading,error:a.error,acceptDisclaimer:h,revokeDisclaimer:i}}(),{isAccepted:p,loading:q}=function(){let[a,b]=(0,d.useState)({settings:g,isAccepted:!1,loading:!0,error:null}),c=(0,d.useCallback)(async()=>{try{let a=await (0,e.bl)("/api/auth/session",{method:"GET",credentials:"include"});if(a.ok){let b=await a.json();return b.authenticated&&b.user}return!1}catch(a){return console.warn("Failed to check authentication status:",a),!1}},[]),f=(0,d.useCallback)(async()=>{try{let a=await (0,e.bl)("/api/user/preferences/cookie-consent",{method:"GET",credentials:"include"});if(a.ok)return(await a.json()).cookieConsent;return null}catch(a){return console.warn("Failed to load cookie consent from database:",a),null}},[]),h=(0,d.useCallback)(async a=>{try{if(!(await (0,e.bl)("/api/user/preferences/cookie-consent",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)})).ok)throw Error("Failed to save cookie consent to database");return!0}catch(a){return console.warn("Failed to save cookie consent to database:",a),!1}},[]),i=(0,d.useCallback)(()=>{try{let a="true"===localStorage.getItem("cookie-consent-accepted"),b=localStorage.getItem("cookie-consent-settings"),c=g;if(b)try{c=JSON.parse(b)}catch(a){console.warn("Failed to parse stored cookie settings:",a)}return{accepted:a,settings:c}}catch(a){return console.warn("Failed to read localStorage cookie consent:",a),{accepted:!1,settings:g}}},[]),j=(0,d.useCallback)((a,b)=>{try{localStorage.setItem("cookie-consent-accepted",b.toString()),localStorage.setItem("cookie-consent-settings",JSON.stringify(a))}catch(a){console.warn("Failed to save to localStorage:",a)}},[]);(0,d.useCallback)(async()=>{b(a=>({...a,loading:!0,error:null}));try{if(await c()){let a=await f();if(a){let c=a.necessary||a.analytics||a.marketing;b(b=>({...b,settings:a,isAccepted:c,loading:!1}))}else{let{accepted:a,settings:c}=i();a&&await h(c)&&console.log("✅ Cookie consent migrated to database:",c),b(b=>({...b,settings:c,isAccepted:a,loading:!1}))}}else{let{accepted:a,settings:c}=i();b(b=>({...b,settings:c,isAccepted:a,loading:!1}))}}catch(d){console.error("Failed to initialize cookie consent:",d);let{accepted:a,settings:c}=i();b(b=>({...b,settings:c,isAccepted:a,loading:!1,error:"Failed to sync with database, using local storage"}))}},[c,f,h,i]);let k=(0,d.useCallback)(async()=>{let a={necessary:!0,analytics:!0,marketing:!0};b(b=>({...b,settings:a,isAccepted:!0})),j(a,!0);try{await c()&&(await h(a)||b(a=>({...a,error:"Failed to sync cookie consent to database"})))}catch(a){console.warn("Failed to save cookie consent:",a),b(a=>({...a,error:"Cookie consent saved locally but failed to sync to database"}))}window.dispatchEvent(new CustomEvent("consentChanged"))},[c,h,j]),l=(0,d.useCallback)(async a=>{let d=a.necessary||a.analytics||a.marketing;b(b=>({...b,settings:a,isAccepted:d})),j(a,d);try{await c()&&(await h(a)||b(a=>({...a,error:"Failed to sync cookie consent to database"})))}catch(a){console.warn("Failed to save cookie consent:",a),b(a=>({...a,error:"Cookie consent saved locally but failed to sync to database"}))}window.dispatchEvent(new CustomEvent("consentChanged"))},[c,h,j]),m=(0,d.useCallback)(async()=>{let a={necessary:!0,analytics:!1,marketing:!1};b(b=>({...b,settings:a,isAccepted:!1})),localStorage.removeItem("cookie-consent-accepted"),localStorage.removeItem("cookie-consent-settings");try{await c()&&(await h(a)||b(a=>({...a,error:"Failed to sync cookie revocation to database"})))}catch(a){console.warn("Failed to revoke cookies:",a),b(a=>({...a,error:"Cookies revoked locally but failed to sync to database"}))}window.dispatchEvent(new CustomEvent("consentRevoked"))},[c,h]);return{settings:a.settings,isAccepted:a.isAccepted,loading:a.loading,error:a.error,acceptAllCookies:k,acceptCookies:l,revokeCookies:m,hasAnalytics:a.settings.analytics,hasMarketing:a.settings.marketing,acceptAll:k,revokeConsent:m}}();(0,d.useCallback)(async()=>{let a=Date.now();if(h&&a-h.timestamp<3e4){b(h.status),k(!1);return}if(j)return void console.log("Consent check already in progress, skipping...");j=!0,k(!0);try{(0,f.lo)();let c=await (0,f.bl)("/api/consent/verify",{method:"POST",headers:{"Content-Type":"application/json"}});if(c.ok){let d=await c.json(),e=!0===d.hasConsented;h={status:e,timestamp:a,sessionId:(0,f.lo)()},b(e),m(a=>a+1)}else console.warn("Consent check failed with status:",c.status),h={status:!1,timestamp:a},b(!1)}catch(a){console.warn("Failed to verify consent with database:",a),h=null,b(!1)}finally{j=!1,k(!1)}},[]);let r=async()=>{if(!c){k(!0);try{let a=await (0,e.rh)();if(!a.success){console.warn("Consent logging warning:",a.message),b(!1),k(!1);return}h={status:!0,timestamp:Date.now(),sessionId:(0,f.lo)()},window.dispatchEvent(new CustomEvent("consentChanged")),b(!0),k(!1),m(a=>a+1),console.log("Consent accepted successfully"),i&&clearTimeout(i),i=window.setTimeout(()=>{},2e3)}catch(a){console.warn("Consent logging failed:",a),b(!1),k(!1);return}}},s=async()=>{if(!c){k(!0);try{let a=(0,f.lo)();console.log(`Revoking consent with session: ${a.substring(0,16)}...`);let c=await (0,f.bl)("/api/consent/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:"client-side-revoke",userAgent:navigator.userAgent})}),d=await c.json();d.success||console.warn("Failed to revoke consent in database:",d.message),h=null,b(!1),k(!1),i&&clearTimeout(i),m(a=>a+1),window.dispatchEvent(new CustomEvent("consentRevoked"))}catch(a){console.warn("Failed to revoke consent from database:",a),h=null,b(!1),k(!1),i&&clearTimeout(i),window.dispatchEvent(new CustomEvent("consentRevoked"))}}};return{isAccepted:a,isCheckingConsent:c,acceptAll:r,revokeConsent:s,forceUpdate:l}}}};