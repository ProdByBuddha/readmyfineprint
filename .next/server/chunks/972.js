"use strict";exports.id=972,exports.ids=[972],exports.modules={4462:(a,b,c)=>{c.d(b,{ui:()=>h,Sf:()=>j,Vl:()=>k,rh:()=>m,bl:()=>d.bl,x0:()=>l,Zh:()=>n,XX:()=>i}),c(42291);var d=c(35201),e=c(81185);class f{static getInstance(){return f.instance||(f.instance=new f),f.instance}constructor(){this.isEnabled=!0,this.reportedErrors=new Set,this.setupGlobalErrorHandlers()}setupGlobalErrorHandlers(){}async reportApiError(a,b,c="GET"){let d=this.determineSeverity(a);await this.reportError({errorType:"api",severity:d,message:`API Error: ${a.message||a.toString()}`,stack:a.stack,additionalContext:{endpoint:b,method:c,status:a.status,statusText:a.statusText,apiError:!0}})}async reportNetworkError(a,b){await this.reportError({errorType:"network",severity:"medium",message:`Network Error: ${a.message||"Connection failed"}`,additionalContext:{url:b,networkError:!0}})}async reportAuthError(a,b){await this.reportError({errorType:"authentication",severity:"medium",message:`Auth Error: ${a}`,additionalContext:{...b,authError:!0}})}async reportError(a){if(this.isEnabled)try{let b,c=this.createErrorHash(a);if(this.reportedErrors.has(c))return;if(this.reportedErrors.add(c),this.reportedErrors.size>100){let a=Array.from(this.reportedErrors);this.reportedErrors=new Set(a.slice(-50))}let d={...a,url:a.url||window.location.href,additionalContext:{...a.additionalContext,userAgent:navigator.userAgent,timestamp:new Date().toISOString(),screenSize:`${window.screen.width}x${window.screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`}},e=0;for(;e<3;){try{let a=await fetch("/api/errors/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),credentials:"include",signal:AbortSignal.timeout(1e4)});if(a.ok)return void console.log("Error reported to admin successfully");console.warn("Failed to report error to admin:",a.status),b=Error(`HTTP ${a.status}`)}catch(a){if(b=a,console.warn(`Error reporting attempt ${e+1} failed:`,a.message),!a.message?.includes("fetch")&&!a.name?.includes("Abort"))break}++e<3&&await new Promise(a=>setTimeout(a,1e3*Math.pow(2,e-1)))}console.error("Failed to report error after all attempts:",b)}catch(a){console.error("Error reporting failed:",a)}}determineSeverity(a){return 401===a.status||403===a.status?"medium":a.status>=500?"high":a.message?.includes("Network Error")||a.message?.includes("Failed to fetch")?"medium":a.message?.includes("TypeError")||a.message?.includes("ReferenceError")?"high":"medium"}createErrorHash(a){return btoa(`${a.errorType}:${a.message}:${a.url}`).substring(0,16)}setEnabled(a){this.isEnabled=a}async reportCriticalError(a,b){await this.reportError({errorType:"frontend",severity:"critical",message:a,additionalContext:{...b,critical:!0}})}}let g=f.getInstance();async function h(a){let b=await (0,d.bl)("/api/documents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a,c=`Failed to create document: ${b.statusText}`;try{let a=await b.text();try{let b=JSON.parse(a);b.error&&(c=b.error)}catch(b){a.includes("<!DOCTYPE")?c="Server error occurred. Please refresh the page and try again.":a&&(c=a)}}catch(a){console.error("Failed to read error response:",a)}throw a=Error(c),g.reportApiError(a,"/api/documents","POST"),Error(c)}try{let a=await b.text();return JSON.parse(a)}catch(a){throw console.error("Failed to parse JSON response:",a),Error("Server returned invalid response. Please refresh the page and try again.")}}async function i(a){let b=new FormData;b.append("file",a);let c=await (0,d.bl)("/api/documents/upload",{method:"POST",body:b});if(!c.ok)try{let a=await c.text();try{let b=JSON.parse(a);throw Error(b.error||a)}catch(b){throw Error(a||`Upload failed: ${c.statusText}`)}}catch(a){throw Error(`Upload failed: ${c.statusText}`)}try{return await c.json()}catch(a){throw console.error("Failed to parse upload response:",a),Error("Server returned invalid response. Please try again.")}}async function j(){let a=await fetch("/api/security-questions/available",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!a.ok)try{let b=await a.text();try{let c=JSON.parse(b);throw Error(c.error||`HTTP error! status: ${a.status}`)}catch(c){throw Error(b||`HTTP error! status: ${a.status}`)}}catch(b){throw Error(`HTTP error! status: ${a.status}`)}try{return await a.json()}catch(a){throw console.error("Failed to parse security questions response:",a),Error("Server returned invalid response. Please try again.")}}async function k(){let a=await fetch("/api/security-questions/user",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!a.ok)try{let b=await a.text();try{let c=JSON.parse(b);throw Error(c.error||`HTTP error! status: ${a.status}`)}catch(c){throw Error(b||`HTTP error! status: ${a.status}`)}}catch(b){throw Error(`HTTP error! status: ${a.status}`)}try{return await a.json()}catch(a){throw console.error("Failed to parse getUserSecurityQuestions response:",a),Error("Server returned invalid response. Please try again.")}}async function l(a){let b=await (0,e.fd)("/api/security-questions/setup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)try{let a=await b.text();try{let c=JSON.parse(a);throw Error(c.error||`HTTP error! status: ${b.status}`)}catch(c){throw Error(a||`HTTP error! status: ${b.status}`)}}catch(a){throw Error(`HTTP error! status: ${b.status}`)}try{return await b.json()}catch(a){throw console.error("Failed to parse setupSecurityQuestions response:",a),Error("Server returned invalid response. Please try again.")}}async function m(){try{let a=(0,d.lo)();console.log(`API: Logging consent with session: ${a.substring(0,16)}...`);let b=await (0,d.bl)("/api/consent",{method:"POST",headers:{"Content-Type":"application/json"}});if(!b.ok)try{let a=await b.text();try{let b=JSON.parse(a);throw Error(b.error||"Failed to log consent")}catch(b){throw Error(a||"Failed to log consent")}}catch(a){throw Error("Failed to log consent")}try{return await b.json()}catch(a){throw console.error("Failed to parse logConsent response:",a),Error("Server returned invalid response. Please try again.")}}catch(a){return console.warn("Consent logging failed:",a),{success:!1,message:"Consent logging failed, but you can continue using the service"}}}async function n(a){let b=(0,d.lo)(),c=await (0,e.fd)("/api/rlhf/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...a,sessionId:b})});if(!c.ok){let a=`Failed to submit feedback: ${c.statusText}`;try{let b=await c.text();try{let c=JSON.parse(b);c.error&&(a=c.error)}catch(c){b&&(a=b)}}catch(a){}throw Error(a)}try{return await c.json()}catch(a){throw console.error("Failed to parse submitPiiDetectionFeedback response:",a),Error("Server returned invalid response. Please try again.")}}},35201:(a,b,c)=>{c.d(b,{bl:()=>g,lo:()=>f});var d=c(81185);let e=null;function f(){return e||(e=sessionStorage.getItem("app-session-id")||crypto.getRandomValues(new Uint8Array(16)).reduce((a,b)=>a+b.toString(16).padStart(2,"0"),""),sessionStorage.setItem("app-session-id",e)),e}async function g(a,b={}){let c=f();if(!["GET","HEAD","OPTIONS"].includes((b.method||"GET").toUpperCase())){let e={...b.headers||{},"x-session-id":c},f=localStorage.getItem("jwt_access_token");f||(f=sessionStorage.getItem("jwt_access_token")),f&&(e.Authorization=`Bearer ${f}`);let g=await (0,d.fd)(a,{...b,headers:e});if(401===g.status&&f&&localStorage.getItem("jwt_refresh_token"))try{let c=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:localStorage.getItem("jwt_refresh_token")}),credentials:"include"});if(c.ok){let f=c.headers.get("content-type");if(f&&f.includes("application/json")){let{tokens:f}=await c.json();localStorage.setItem("jwt_access_token",f.access),localStorage.setItem("jwt_refresh_token",f.refresh),sessionStorage.setItem("jwt_access_token",f.access),sessionStorage.setItem("jwt_refresh_token",f.refresh);let g={...e,Authorization:`Bearer ${f.access}`};return(0,d.fd)(a,{...b,headers:g})}}}catch(a){console.log("Token refresh failed for CSRF request:",a instanceof Error?a.message:"Unknown error"),localStorage.removeItem("jwt_access_token"),localStorage.removeItem("jwt_refresh_token")}return g}let h={...b.headers||{},"x-session-id":c},i=localStorage.getItem("jwt_access_token");i&&(h.Authorization=`Bearer ${i}`);let j=await fetch(a,{...b,headers:h,credentials:"include"});if(401===j.status&&i&&localStorage.getItem("jwt_refresh_token"))try{let c=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:localStorage.getItem("jwt_refresh_token")}),credentials:"include"});if(c.ok){let d=c.headers.get("content-type");if(d&&d.includes("application/json")){let{tokens:d}=await c.json();localStorage.setItem("jwt_access_token",d.access),localStorage.setItem("jwt_refresh_token",d.refresh);let e={...h,Authorization:`Bearer ${d.access}`};return fetch(a,{...b,headers:e,credentials:"include"})}console.warn("Refresh endpoint returned non-JSON response")}else console.log("Token refresh failed with status:",c.status)}catch(a){console.log("Token refresh failed:",a instanceof Error?a.message:"Unknown error"),localStorage.removeItem("jwt_access_token"),localStorage.removeItem("jwt_refresh_token")}else j.status;let k=j.headers.get("x-session-id");return k&&k!==c&&(e=k,sessionStorage.setItem("app-session-id",k)),j}},37826:(a,b,c)=>{c.d(b,{Cf:()=>l,L3:()=>n,c7:()=>m,lG:()=>i,rr:()=>o});var d=c(60687),e=c(43210),f=c(26134),g=c(11860),h=c(96241);let i=f.bL;f.l9;let j=f.ZL;f.bm;let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.hJ,{ref:c,className:(0,h.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...b}));k.displayName=f.hJ.displayName;let l=e.forwardRef(({className:a,children:b,hideCloseButton:c,...e},i)=>(0,d.jsxs)(j,{children:[(0,d.jsx)(k,{}),(0,d.jsxs)(f.UC,{ref:i,className:(0,h.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...e,children:[b,!c&&(0,d.jsxs)(f.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-all hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 w-6 h-6 flex items-center justify-center",children:[(0,d.jsx)(g.A,{className:"h-4 w-4"}),(0,d.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));l.displayName=f.UC.displayName;let m=({className:a,...b})=>(0,d.jsx)("div",{className:(0,h.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...b});m.displayName="DialogHeader";let n=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.hE,{ref:c,className:(0,h.cn)("text-lg font-semibold leading-none tracking-tight",a),...b}));n.displayName=f.hE.displayName;let o=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.VY,{ref:c,className:(0,h.cn)("text-sm text-muted-foreground",a),...b}));o.displayName=f.VY.displayName},81185:(a,b,c)=>{c.d(b,{fd:()=>f});class d{async getToken(a){if(this.token&&Date.now()<this.tokenExpiry)return this.token;if(this.fetchPromise)try{return await this.fetchPromise}catch(a){throw this.fetchPromise=null,a}this.fetchPromise=this.fetchTokenFromServer(a);try{let a=await this.fetchPromise;return this.fetchPromise=null,a}catch(a){throw this.fetchPromise=null,a}}async fetchTokenFromServer(a){try{let b=await fetch("/api/csrf-token",{method:"GET",headers:{"Content-Type":"application/json","x-session-id":a},credentials:"include"});if(!b.ok)throw Error(`Failed to fetch CSRF token: ${b.status}`);let c=await b.json();if(!c.csrfToken)throw Error("No CSRF token received from server");return this.token=c.csrfToken,this.tokenExpiry=Date.now()+this.TOKEN_VALIDITY,c.csrfToken}catch(a){throw a}}async addTokenToHeaders(a,b={}){try{let c=await this.getToken(a);return{...b,"x-csrf-token":c}}catch(a){return b}}async fetch(a,b={},c){if(["GET","HEAD","OPTIONS"].includes((b.method||"GET").toUpperCase()))return fetch(a,{...b,credentials:"include"});try{let d=await this.addTokenToHeaders(c,b.headers||{}),e=await fetch(a,{...b,headers:d,credentials:"include"});if(403===e.status){let d=await e.text();if(d.includes("CSRF")||d.includes("csrf")){this.clearToken();let d=await this.addTokenToHeaders(c,b.headers||{});return fetch(a,{...b,headers:d,credentials:"include"})}}return e}catch(a){throw a}}clearToken(){this.token=null,this.tokenExpiry=0,this.fetchPromise=null}hasValidToken(){return null!==this.token&&Date.now()<this.tokenExpiry}getCurrentToken(){return this.token}constructor(){this.token=null,this.tokenExpiry=0,this.TOKEN_VALIDITY=9e6,this.fetchPromise=null}}let e=new d;async function f(a,b={}){let c=sessionStorage.getItem("app-session-id")||"anonymous";return e.fetch(a,b,c)}},82972:(a,b,c)=>{c.d(b,{xF:()=>k}),c(60687);var d=c(43210);c(24934),c(37826);var e=c(4462),f=c(35201);let g={necessary:!0,analytics:!1,marketing:!1},h=null,i=null,j=!1;function k(){let[a,b]=(0,d.useState)(!1),[c,k]=(0,d.useState)(!0),[l,m]=(0,d.useState)(0),{accepted:n,loading:o}=function(){let[a,b]=(0,d.useState)({accepted:!1,loading:!0,error:null}),c=(0,d.useCallback)(async()=>{try{if(!(document.cookie.includes("subscriptionToken")||document.cookie.includes("subscription_token")||localStorage.getItem("jwt_access_token")||localStorage.getItem("jwt_refresh_token")||localStorage.getItem("jwt_token")))try{let a=await (0,e.bl)("/api/auth/session",{method:"GET",credentials:"include"});if(a.ok){let b=await a.json();return b.authenticated&&b.user}a.status}catch(a){console.log("Session check failed, assuming unauthenticated:",a)}return!1}catch(a){return a instanceof Error&&!a.message.includes("401")&&console.warn("Failed to check authentication status:",a),!1}},[]),f=(0,d.useCallback)(async()=>{try{let a=await (0,e.bl)("/api/user/preferences/legal-disclaimer",{method:"GET",credentials:"include"});if(a.ok)return(await a.json()).accepted;return 401===a.status||429===a.status&&console.log("Rate limited loading disclaimer from database, using localStorage"),null}catch(a){return a instanceof Error&&!a.message.includes("401")&&console.warn("Failed to load legal disclaimer from database:",a),null}},[]),g=(0,d.useCallback)(async a=>{try{let b=await (0,e.bl)("/api/user/preferences/legal-disclaimer",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({accepted:a})});if(!b.ok){if(429===b.status)return console.log("Rate limited saving disclaimer to database, saved to localStorage only"),!0;if(401===b.status)return!0;throw Error("Failed to save legal disclaimer to database")}return!0}catch(a){return console.warn("Failed to save legal disclaimer to database:",a),!1}},[]);(0,d.useCallback)(async()=>{if(!a.loading){b(a=>({...a,loading:!0,error:null}));try{if(await c()){let a=await f();if(null!==a)b(b=>({...b,accepted:a,loading:!1}));else{let a="true"===localStorage.getItem("readmyfineprint-disclaimer-accepted");a&&await g(a)&&console.log("✅ Legal disclaimer acceptance migrated to database:",a),b(b=>({...b,accepted:a,loading:!1}))}}else{let a="true"===localStorage.getItem("readmyfineprint-disclaimer-accepted");b(b=>({...b,accepted:a,loading:!1}))}}catch(c){console.error("Failed to initialize legal disclaimer:",c);let a="true"===localStorage.getItem("readmyfineprint-disclaimer-accepted");b(b=>({...b,accepted:a,loading:!1,error:"Failed to sync with database, using local storage"}))}}},[c,f,g]);let h=(0,d.useCallback)(async()=>{b(a=>({...a,accepted:!0}));let a=new Date().toISOString();localStorage.setItem("readmyfineprint-disclaimer-accepted","true"),localStorage.setItem("readmyfineprint-disclaimer-date",a);try{await c()&&(await g(!0)||b(a=>({...a,error:"Failed to sync disclaimer acceptance to database"})))}catch(a){console.warn("Failed to save disclaimer acceptance:",a),b(a=>({...a,error:"Disclaimer saved locally but failed to sync to database"}))}},[c,g]),i=(0,d.useCallback)(async()=>{b(a=>({...a,accepted:!1})),localStorage.removeItem("readmyfineprint-disclaimer-accepted"),localStorage.removeItem("readmyfineprint-disclaimer-date");try{await c()&&(await g(!1)||b(a=>({...a,error:"Failed to sync disclaimer revocation to database"})))}catch(a){console.warn("Failed to revoke disclaimer:",a),b(a=>({...a,error:"Disclaimer revoked locally but failed to sync to database"}))}},[c,g]);return{accepted:a.accepted,loading:a.loading,error:a.error,acceptDisclaimer:h,revokeDisclaimer:i}}(),{isAccepted:p,loading:q}=function(){let[a,b]=(0,d.useState)({settings:g,isAccepted:!1,loading:!0,error:null}),c=(0,d.useCallback)(async()=>{try{let a=await (0,e.bl)("/api/auth/session",{method:"GET",credentials:"include"});if(a.ok){let b=await a.json();return b.authenticated&&b.user}return!1}catch(a){return console.warn("Failed to check authentication status:",a),!1}},[]),f=(0,d.useCallback)(async()=>{try{let a=await (0,e.bl)("/api/user/preferences/cookie-consent",{method:"GET",credentials:"include"});if(a.ok)return(await a.json()).cookieConsent;return null}catch(a){return console.warn("Failed to load cookie consent from database:",a),null}},[]),h=(0,d.useCallback)(async a=>{try{if(!(await (0,e.bl)("/api/user/preferences/cookie-consent",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)})).ok)throw Error("Failed to save cookie consent to database");return!0}catch(a){return console.warn("Failed to save cookie consent to database:",a),!1}},[]),i=(0,d.useCallback)(()=>{try{let a="true"===localStorage.getItem("cookie-consent-accepted"),b=localStorage.getItem("cookie-consent-settings"),c=g;if(b)try{c=JSON.parse(b)}catch(a){console.warn("Failed to parse stored cookie settings:",a)}return{accepted:a,settings:c}}catch(a){return console.warn("Failed to read localStorage cookie consent:",a),{accepted:!1,settings:g}}},[]),j=(0,d.useCallback)((a,b)=>{try{localStorage.setItem("cookie-consent-accepted",b.toString()),localStorage.setItem("cookie-consent-settings",JSON.stringify(a))}catch(a){console.warn("Failed to save to localStorage:",a)}},[]);(0,d.useCallback)(async()=>{b(a=>({...a,loading:!0,error:null}));try{if(await c()){let a=await f();if(a){let c=a.necessary||a.analytics||a.marketing;b(b=>({...b,settings:a,isAccepted:c,loading:!1}))}else{let{accepted:a,settings:c}=i();a&&await h(c)&&console.log("✅ Cookie consent migrated to database:",c),b(b=>({...b,settings:c,isAccepted:a,loading:!1}))}}else{let{accepted:a,settings:c}=i();b(b=>({...b,settings:c,isAccepted:a,loading:!1}))}}catch(d){console.error("Failed to initialize cookie consent:",d);let{accepted:a,settings:c}=i();b(b=>({...b,settings:c,isAccepted:a,loading:!1,error:"Failed to sync with database, using local storage"}))}},[c,f,h,i]);let k=(0,d.useCallback)(async()=>{let a={necessary:!0,analytics:!0,marketing:!0};b(b=>({...b,settings:a,isAccepted:!0})),j(a,!0);try{await c()&&(await h(a)||b(a=>({...a,error:"Failed to sync cookie consent to database"})))}catch(a){console.warn("Failed to save cookie consent:",a),b(a=>({...a,error:"Cookie consent saved locally but failed to sync to database"}))}window.dispatchEvent(new CustomEvent("consentChanged"))},[c,h,j]),l=(0,d.useCallback)(async a=>{let d=a.necessary||a.analytics||a.marketing;b(b=>({...b,settings:a,isAccepted:d})),j(a,d);try{await c()&&(await h(a)||b(a=>({...a,error:"Failed to sync cookie consent to database"})))}catch(a){console.warn("Failed to save cookie consent:",a),b(a=>({...a,error:"Cookie consent saved locally but failed to sync to database"}))}window.dispatchEvent(new CustomEvent("consentChanged"))},[c,h,j]),m=(0,d.useCallback)(async()=>{let a={necessary:!0,analytics:!1,marketing:!1};b(b=>({...b,settings:a,isAccepted:!1})),localStorage.removeItem("cookie-consent-accepted"),localStorage.removeItem("cookie-consent-settings");try{await c()&&(await h(a)||b(a=>({...a,error:"Failed to sync cookie revocation to database"})))}catch(a){console.warn("Failed to revoke cookies:",a),b(a=>({...a,error:"Cookies revoked locally but failed to sync to database"}))}window.dispatchEvent(new CustomEvent("consentRevoked"))},[c,h]);return{settings:a.settings,isAccepted:a.isAccepted,loading:a.loading,error:a.error,acceptAllCookies:k,acceptCookies:l,revokeCookies:m,hasAnalytics:a.settings.analytics,hasMarketing:a.settings.marketing,acceptAll:k,revokeConsent:m}}();(0,d.useCallback)(async()=>{let a=Date.now();if(h&&a-h.timestamp<3e4){b(h.status),k(!1);return}if(j)return void console.log("Consent check already in progress, skipping...");j=!0,k(!0);try{(0,f.lo)();let c=await (0,f.bl)("/api/consent/verify",{method:"POST",headers:{"Content-Type":"application/json"}});if(c.ok){let d=await c.json(),e=!0===d.hasConsented;h={status:e,timestamp:a,sessionId:(0,f.lo)()},b(e),m(a=>a+1)}else console.warn("Consent check failed with status:",c.status),h={status:!1,timestamp:a},b(!1)}catch(a){console.warn("Failed to verify consent with database:",a),h=null,b(!1)}finally{j=!1,k(!1)}},[]);let r=async()=>{if(!c){k(!0);try{let a=await (0,e.rh)();if(!a.success){console.warn("Consent logging warning:",a.message),b(!1),k(!1);return}h={status:!0,timestamp:Date.now(),sessionId:(0,f.lo)()},window.dispatchEvent(new CustomEvent("consentChanged")),b(!0),k(!1),m(a=>a+1),console.log("Consent accepted successfully"),i&&clearTimeout(i),i=window.setTimeout(()=>{},2e3)}catch(a){console.warn("Consent logging failed:",a),b(!1),k(!1);return}}},s=async()=>{if(!c){k(!0);try{let a=(0,f.lo)();console.log(`Revoking consent with session: ${a.substring(0,16)}...`);let c=await (0,f.bl)("/api/consent/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ip:"client-side-revoke",userAgent:navigator.userAgent})}),d=await c.json();d.success||console.warn("Failed to revoke consent in database:",d.message),h=null,b(!1),k(!1),i&&clearTimeout(i),m(a=>a+1),window.dispatchEvent(new CustomEvent("consentRevoked"))}catch(a){console.warn("Failed to revoke consent from database:",a),h=null,b(!1),k(!1),i&&clearTimeout(i),window.dispatchEvent(new CustomEvent("consentRevoked"))}}};return{isAccepted:a,isCheckingConsent:c,acceptAll:r,revokeConsent:s,forceUpdate:l}}}};