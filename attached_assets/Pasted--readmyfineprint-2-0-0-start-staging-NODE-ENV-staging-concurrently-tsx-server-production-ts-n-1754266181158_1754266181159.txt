> readmyfineprint@2.0.0 start:staging
> NODE_ENV=staging concurrently "tsx server/production.ts" "node scripts/local-llm-server.cjs" "npm run monitor:continuous"

[1] ğŸš€ Local LLM server running on port 11434
[1] ğŸ“¡ Compatible with Ollama API endpoints
[1] ğŸ” Ready for PII detection requests
[1] ğŸ›‘ Press Ctrl+C to stop
[2] 
[2] > readmyfineprint@2.0.0 monitor:continuous
[2] > node scripts/production-monitor.js --continuous
[2] 
[2] ğŸš€ Production Monitor initialized for staging environment
[2] ğŸ“§ Email alerts enabled for: prodbybuddha@icloud.com
[2] ğŸš€ Starting continuous production monitoring...
[2] ğŸ“Š Environment: staging
[2] â° Check interval: 120 seconds
[2] Press Ctrl+C to stop
[2] 
[[0] âœ“ Consent logging enabled with PostgreSQL database.
[0] Blog Scheduler initialized with config: {
[0]   enabled: false,
[0]   postsPerDay: 3,
[0]   hours: [ 9, 13, 17 ],
[0]   maxPostsPerHour: 1,
[0]   timezone: 'America/New_York',
[0]   minHoursBetweenPosts: 4
[0] }
[0] âœ… JWT Secret Manager initialized with versioned secrets
[0] ğŸ“‹ Initialized 4 disaster recovery scenarios
[0] ğŸ” Started continuous health monitoring
[0] ğŸ”‘ Using Stripe key: sk_live_51RWnyY... (test mode: false)
[0] ğŸš€ Starting ReadMyFinePrint Production Server...
[0] ğŸ” Validating environment variables...
[0] âœ… OPENAI_API_KEY: sk-***
[0] âœ… ADMIN_API_KEY: 81ad52472ab148577fb4ba109d09901d1e9b5d55479ccebbea...
[0] âœ… JWT_SECRET: KQvWGiKq5jAfsTSHFID1StgprPQAusDKhJmSdVFKgZI5W/nF2O...
[0] âœ… TOKEN_ENCRYPTION_KEY: ddf455b6fd8c0e59d5893bf44e7bca157c0ad51405258c7bee...
[0] âœ… PASSWORD_PEPPER: b0dea38aca02ad50d94b704f127740decf0e4839b66c6f145d...
[0] âœ… ALLOWED_ORIGINS: https://readmyfineprint.com,https://edcf3ef7-a826-...
[0] âœ… NODE_ENV: staging
[0] âœ… SESSION_ENCRYPTION_KEY: 2651fc8605cabc8b756adbc6861138afe8cf520d54417763ee...
[0] âœ… REPLIT_DB_URL: https://kv.replit.com/v0/eyJhbGciOiJIUzUxMiIsImlzc...
[0] ğŸš§ Running in staging environment
[0] âœ… STRIPE_PUBLIC_KEY: pk_live_51RWnyYLNxaR...
[0] âœ… STRIPE_SECRET_KEY: sk_live_51...
[0] âœ… STRIPE_TEST_PUBLIC_KEY: pk_test_51RWnynPxX1d...
[0] âœ… STRIPE_TEST_SECRET_KEY: sk_test_51...
[0] ğŸ”„ Concurrent test/live payment processing enabled
[0] 
[0] ğŸ“‹ Warnings:
[0]    âš ï¸  Optional SECURITY_WEBHOOK_URL not set - Optional webhook URL for security alerts (for external monitoring)
[0] âœ… Environment validation passed
[0]    (1 warning)
[0] 
[0] ğŸ”§ Environment Configuration:
[0]    Environment: staging
[0]    OpenAI API: âœ… Configured
[0]    Admin Auth: âœ… Configured
[0]    CORS Origins: https://readmyfineprint.com,https://edcf3ef7-a826-4eed-8e04-7a485b2e183a-00-1wyt...
[0] 
[0] âœ… Secure JWT Service initialized with refresh token support
[0] Warning: Indexing all PDF objects
[0] ğŸ“… Backup schedules configured
[0] âœ… Backup service initialized with automated scheduling
[0] ğŸ” Checking database migrations...
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | f15f50b0 | Secure JWT Service initialized | initialization
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | caf37866 | JWT Secret Manager initialized successfully | initialization
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1f81d322 | Backup service initialized successfully | initialization
[0] âœ… Email service configured and verified with SMTP (smtp.mail.me.com)
[0] âœ… Database schema is up to date
[0] âœ… Two-Factor Authentication routes registered
[0] ğŸ” [Tier Monitor] Started periodic monitoring (every 30 minutes)
[0] ğŸ“‹ Production server running on http://0.0.0.0:5000
[0] ğŸ“‹ Production server running on http://0.0.0.0:5000
[0] ğŸ” [Startup] Running initial admin tier verification...
[0] [Admin Detection] Recognized known admin user ID: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Check] User c970c8a1-3a9d-43e0-b758-e5092db524ff admin status: true
[0] [Admin Access] Providing ultimate tier for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[0] [Admin Setup] Admin user already has ultimate tier subscription
[0] [Admin Access] Returning ultimate tier (Ultimate) for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Detection] Recognized known admin user ID: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Detection] Recognized known admin user ID: 24c3ec47-dd61-4619-9c9e-18abbd0981ea
[0] [Admin Check] User 24c3ec47-dd61-4619-9c9e-18abbd0981ea admin status: true
[0] [Admin Access] Providing ultimate tier for admin user: 24c3ec47-dd61-4619-9c9e-18abbd0981ea
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[0] [Admin Setup] Admin user already has ultimate tier subscription
[0] [Admin Access] Returning ultimate tier (Ultimate) for admin user: 24c3ec47-dd61-4619-9c9e-18abbd0981ea
[0] [Admin Detection] Recognized known admin user ID: 24c3ec47-dd61-4619-9c9e-18abbd0981ea
[0] ğŸ” [Tier Monitor] Checked 2 admin users, found 0 issues
[0] âœ… [Startup] All admin tier assignments verified correct
[0] Consent verification request - IP: 10.82.2.33, UA: Mozilla/5.0 (Windows..., User: none, Session: ef4bea13244618c87987d58d6e096e0c
[0] Generated pseudonym d0fa8c2df296c568734e6634 from identifier: session:ef4bea13244618c87987d58d6e096e0c...
[0] Verifying consent for pseudonym: d0fa8c2df296c568734e6634 (IP: 10.82.2.33, UA: Mozilla/5.0 (Windows..., User: none, Session: ef4bea13244618c8)
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[0] Consent verification result for d0fa8c2df296c568734e6634: true (ID: ca7a782b8af69b4ebf837549)
[0] Consent verification response: true (session: ef4bea13244618c87987d58d6e096e0c)
[0] âœ… JOSE Auth Service initialized with key length: 32 bytes
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | b4080c56 | JOSE Auth Service initialized | initialization
[0] ğŸ§¹ Cleaned up 0 expired refresh tokens and 0 expired revocations
[0] Session cleanup completed: 0 expired sessions removed
[0] ğŸ§¹ Startup cleanup: 0 expired tokens removed, 0 expired sessions removed
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[2] 
[2] ğŸ” Production Health Check - 2025-08-04T00:05:37.904Z
[2] ğŸŒ Environment: staging
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] âœ… SERVER: Server responding normally
[2] âœ… DATABASE: Server responding normally
[0] âœ… Email configuration test successful
[2] âœ… EMAIL: Email service configured and ready
[2] âœ… PROCESSES: 27 server processes running
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] Overall Status: âœ… HEALTHY
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[0] Consent verification request - IP: 10.82.2.33, UA: Mozilla/5.0 (Windows..., User: none, Session: ef4bea13244618c87987d58d6e096e0c
[0] Generated pseudonym d0fa8c2df296c568734e6634 from identifier: session:ef4bea13244618c87987d58d6e096e0c...
[0] Verifying consent for pseudonym: d0fa8c2df296c568734e6634 (IP: 10.82.2.33, UA: Mozilla/5.0 (Windows..., User: none, Session: ef4bea13244618c8)
[0] Using cached consent result for d0fa8c2df296c568734e6634: true
[0] Consent verification response: true (session: ef4bea13244618c87987d58d6e096e0c)
[0] ğŸª Cookie-parser failed, trying manual parsing...
[0] ğŸª Raw cookie header: __stripe_mid=dca14496-80be-4f68-9ddc-36fecc86d19f45dd56; __stripe_sid=2c5f1755-c51d-454f-92a0-e6ab7f...
[0] ğŸª Parsed cookies: {"__stripe_mid":"dca14496-80be-4f68-9ddc-36fecc86d19f45dd56","__stripe_sid":"2c5f1755-c51d-454f-92a0-e6ab7f39871d4c9bad"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'ef4bea13...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: ef4bea13...
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'none',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'missing'
[0]   }
[0] }
[0] âŒ No session ID found in cookies or headers
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: c30b06c1...
[0] Consent verification request - IP: 10.82.0.253, UA: Mozilla/5.0 (Windows..., User: none, Session: c30b06c17a628a7bb85d25aaff947893
[0] Generated pseudonym 88452ff30b5e48c23538779f from identifier: session:c30b06c17a628a7bb85d25aaff947893...
[0] Verifying consent for pseudonym: 88452ff30b5e48c23538779f (IP: 10.82.0.253, UA: Mozilla/5.0 (Windows..., User: none, Session: c30b06c17a628a7b)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: c30b06c1...
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: c30b06c1...
[0] Consent verification result for 88452ff30b5e48c23538779f: false 
[0] Consent verification response: false (session: c30b06c17a628a7bb85d25aaff947893)
[0] Consent logging request - IP: 10.82.2.33, UA: Mozilla/5.0 (Windows..., User: none, Session: c30b06c17a628a7bb85d25aaff947893
[0] Logging consent - IP: 10.82.2.33, UA: Mozilla/5.0 (Windows..., User: none, Session: c30b06c17a628a7bb85d25aaff947893
[0] Generated pseudonym 88452ff30b5e48c23538779f from identifier: session:c30b06c17a628a7bb85d25aaff947893...
[0] Consent logged - ID: c156de6b21821c4a1b4db7e4, Pseudonym: 88452ff30b5e48c23538779f
[0] Consent verification request - IP: 10.82.2.33, UA: Mozilla/5.0 (Windows..., User: none, Session: c30b06c17a628a7bb85d25aaff947893
[0] Generated pseudonym 88452ff30b5e48c23538779f from identifier: session:c30b06c17a628a7bb85d25aaff947893...
[0] Verifying consent for pseudonym: 88452ff30b5e48c23538779f (IP: 10.82.2.33, UA: Mozilla/5.0 (Windows..., User: none, Session: c30b06c17a628a7b)
[0] Consent verification result for 88452ff30b5e48c23538779f: true (ID: c156de6b21821c4a1b4db7e4)
[0] Consent verification response: true (session: c30b06c17a628a7bb85d25aaff947893)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: c30b06c1...
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: c30b06c1...
[0] ğŸ“– Get document request: DocumentID=1, SessionID=c30b06c17a628a7bb85d25aaff947893
[0] ğŸ“‹ Retrieved document 1: hasAnalysis=false, analysisType=object
[0] âœ… Document 1 found and returned (GET)
[0] ğŸ“Š Document analysis status: Missing
[0] Generated pseudonym 88452ff30b5e48c23538779f from identifier: session:c30b06c17a628a7bb85d25aaff947893...
[0] Verifying consent for pseudonym: 88452ff30b5e48c23538779f (IP: 10.82.2.33, UA: Mozilla/5.0 (Windows..., User: none, Session: c30b06c17a628a7b)
[0] Using cached consent result for 88452ff30b5e48c23538779f: true
[0] ğŸ” Analysis request: DocumentID=1, SessionID=c30b06c17a628a7bb85d25aaff947893
[0] ğŸ“‹ Retrieved document 1: hasAnalysis=false, analysisType=object
[0] ğŸ“‹ Sample contract detected (Sample: Residential Lease Agreement), skipping consent check
[0] ğŸ“Š No valid subscription token, using session/user-based lookup for: c30b06c17a628a7bb85d25aaff947893
[0] ğŸ“Š Session-based user detected (c30b06c17a628a7bb85d25aaff947893), providing free tier without subscription record
[0] ğŸ“Š Individual anonymous user (c30b06c17a628a7bb85d25aaff947893) usage: 0 documents analyzed this month
[0] [Priority Queue] Added free tier request (priority: 5). Queue length: 1
[0] [Priority Queue] Processing free tier request. Currently processing: 1/3
[0] ğŸ“ Using standard analysis for free tier user c30b06c17a628a7bb85d25aaff947893
[0] ğŸ¤– Sending to OpenAI (gpt-4o-mini):
[0]    - Document: "Sample: Residential Lease Agreement"
[0]    - Content length: 1940 characters
[0]    - Content preview (first 500 chars): "RESIDENTIAL LEASE AGREEMENT\n\nProperty: 456 Oak Avenue, Apartment 2B, Portland, OR 97201\n\nPARTIES: Sunset Properties LLC ("Landlord") and [Tenant Name] ("Tenant")\n\n1. LEASE TERM\n- Start Date: January 1, 2025\n- End Date: December 31, 2025\n- Month-to-month after initial term unless terminated\n\n2. RENT AND FEES\n- Monthly Rent: $2,400 (due 1st of each month)\n- Late Fee: $150 if rent is more than 5 days late\n- Security Deposit: $2,400 (non-refundable cleaning fee of $200)\n- Pet Deposit: $500 per pet ("
[0]    - Readable character ratio: 90.2%
[0] ğŸ“¤ RAW REQUEST PAYLOAD TO OPENAI:
[0] {
[0]   "model": "gpt-4o-mini",
[0]   "messages": [
[0]     {
[0]       "role": "system",
[0]       "content": "You are a legal document analysis expert who specializes in making complex legal language understandable to everyday users. Always respond with valid JSON."
[0]     },
[0]     {
[0]       "role": "user",
[0]       "content": "You are a legal document analysis expert. Analyze the following legal document and provide a comprehensive analysis in JSON format.\n\nDocument Title: Sample: Residential Lease Agreement\nDocument Content: RESIDENTIAL LEASE AGREEMENT\n\nProperty: 456 Oak Avenue, Apartment 2B, Portland, OR 97201\n\nPARTIES: Sunset Properties LLC (\"Landlord\") and [Tenant Name] (\"Tenant\")\n\n1. LEASE TERM\n- Start Date: January 1, 2025\n- End Date: December 31, 2025\n- Month-to-month after initial term unless terminated\n\n2. RENT AND FEES\n- Monthly Rent: $2,400 (due 1st of each month)\n- Late Fee: $150 if rent is more than 5 days late\n- Security Deposit: $2,400 (non-refundable cleaning fee of $200)\n- Pet Deposit: $500 per pet (maximum 2 pets)\n\n3. UTILITIES AND SERVICES\n- Tenant responsible for: electricity, gas, internet, cable\n- Landlord provides: water, sewer, trash collection\n- Utilities must remain in Tenant's name throughout lease\n\n4. PROPERTY USE AND RESTRICTIONS\n- Residential use only, maximum 2 occupants\n- No smoking anywhere on property (including balcony)\n- No loud music or parties after 10 PM\n- No alterations without written consent\n- Subletting prohibited without prior approval\n\n5. MAINTENANCE AND REPAIRS\n- Tenant responsible for repairs under $100\n- Landlord responsible for major repairs and appliances\n- 48-hour notice required for non-emergency entry\n- Tenant must report maintenance issues within 24 hours\n\n6. DEPOSIT AND DAMAGES\n- Security deposit held for damages beyond normal wear\n- Landlord has 60 days to return deposit after move-out\n- Tenant liable for all damages regardless of deposit amount\n- Professional cleaning required upon move-out\n\n7. TERMINATION AND PENALTIES\n- 60-day written notice required for termination\n- Early termination fee: 2 months rent\n- Holdover tenancy charged at 150% of monthly rent\n- Landlord may terminate immediately for any lease violation\n\n8. LIABILITY AND INSURANCE\n- Tenant must carry renter's insurance minimum $100,000\n- Landlord not liable for theft, damage, or injury on property\n- Tenant liable for all guest actions and damages\n\nContact: manager@sunsetproperties.com\nEmergency: (503) 555-0199\n\nPlease analyze this document and provide a JSON response with the following structure:\n{\n  \"summary\": \"A brief overall summary of the document in plain English\",\n  \"overallRisk\": \"low|moderate|high\",\n  \"keyFindings\": {\n    \"goodTerms\": [\"List of positive or fair terms found\"],\n    \"reviewNeeded\": [\"Terms that require attention but aren't necessarily bad\"],\n    \"redFlags\": [\"Concerning clauses or terms that pose significant risk\"]\n  },\n  \"sections\": [\n    {\n      \"title\": \"Section name (e.g., Payment Terms, Privacy Policy, etc.)\",\n      \"riskLevel\": \"low|moderate|high\",\n      \"summary\": \"Plain English explanation of this section\",\n      \"concerns\": [\"List of specific concerns for this section if any\"]\n    }\n  ]\n}\n\nFocus on:\n- Converting legal jargon to plain English\n- Identifying unfair, unusual, or concerning terms\n- Highlighting automatic renewals, data usage, liability limitations\n- Explaining payment terms, cancellation policies, and user rights\n- Noting jurisdiction limitations or binding arbitration clauses\n\nProvide practical, actionable insights that help everyday users understand what they're agreeing to."
[0]     }
[0]   ],
[0]   "response_format": {
[0]     "type": "json_object"
[0]   },
[0]   "temperature": 0.3
[0] }
[0] â„¹ï¸ [SECURITY] API_ACCESS | LOW | 7bbecde6 | Document sent to OpenAI for analysis | /api/documents/*/analyze | {"documentTitle":"Sample: Residential Lease Agreement","service":"OpenAI"}
[0] ğŸ“¥ RAW RESPONSE PAYLOAD FROM OPENAI:
[0] {
[0]   "id": "chatcmpl-C0d0xqJ0vdrDxtEhfQFnbl4V9lEVX",
[0]   "object": "chat.completion",
[0]   "created": 1754266007,
[0]   "model": "gpt-4o-mini-2024-07-18",
[0]   "choices": [
[0]     {
[0]       "index": 0,
[0]       "message": {
[0]         "role": "assistant",
[0]         "content": "{\n  \"summary\": \"This document is a Residential Lease Agreement between Sunset Properties LLC and the Tenant for an apartment in Portland, Oregon. It outlines the terms of the lease, including rent, responsibilities for utilities, property use restrictions, maintenance obligations, and termination conditions.\",\n  \"overallRisk\": \"moderate\",\n  \"keyFindings\": {\n    \"goodTerms\": [\n      \"Clear definition of responsibilities for utilities and maintenance.\",\n      \"Fixed lease term with month-to-month option after initial term.\"\n    ],\n    \"reviewNeeded\": [\n      \"High late fee of $150 for rent paid more than 5 days late.\",\n      \"Security deposit is non-refundable for cleaning, which may be seen as excessive.\"\n    ],\n    \"redFlags\": [\n      \"Early termination fee of 2 months' rent is quite high.\",\n      \"Landlord can terminate immediately for any lease violation, which may be overly broad.\"\n    ]\n  },\n  \"sections\": [\n    {\n      \"title\": \"Lease Term\",\n      \"riskLevel\": \"low\",\n      \"summary\": \"The lease starts on January 1, 2025, and ends on December 31, 2025. After that, it becomes a month-to-month lease unless either party terminates it.\",\n      \"concerns\": []\n    },\n    {\n      \"title\": \"Rent and Fees\",\n      \"riskLevel\": \"moderate\",\n      \"summary\": \"Rent is $2,400 per month, due on the 1st. A late fee of $150 applies if rent is more than 5 days late. A security deposit of $2,400 is required, with a non-refundable cleaning fee of $200.\",\n      \"concerns\": [\n        \"The late fee is relatively high compared to industry standards.\",\n        \"The non-refundable cleaning fee may be seen as unfair.\"\n      ]\n    },\n    {\n      \"title\": \"Utilities and Services\",\n      \"riskLevel\": \"low\",\n      \"summary\": \"The Tenant is responsible for electricity, gas, internet, and cable, while the Landlord covers water, sewer, and trash collection.\",\n      \"concerns\": []\n    },\n    {\n      \"title\": \"Property Use and Restrictions\",\n      \"riskLevel\": \"moderate\",\n      \"summary\": \"The property is for residential use only, with a maximum of 2 occupants. Smoking is prohibited, and no loud music or parties are allowed after 10 PM.\",\n      \"concerns\": [\n        \"Restrictions on smoking and noise may be too strict for some tenants.\"\n      ]\n    },\n    {\n      \"title\": \"Maintenance and Repairs\",\n      \"riskLevel\": \"low\",\n      \"summary\": \"The Tenant is responsible for repairs under $100, while the Landlord handles major repairs. The Tenant must report issues within 24 hours.\",\n      \"concerns\": []\n    },\n    {\n      \"title\": \"Deposit and Damages\",\n      \"riskLevel\": \"moderate\",\n      \"summary\": \"The security deposit covers damages beyond normal wear and must be returned within 60 days after move-out. The Tenant is liable for all damages.\",\n      \"concerns\": [\n        \"The requirement for professional cleaning upon move-out may incur additional costs.\"\n      ]\n    },\n    {\n      \"title\": \"Termination and Penalties\",\n      \"riskLevel\": \"high\",\n      \"summary\": \"A 60-day written notice is required to terminate the lease. An early termination fee of 2 months' rent applies, and the Landlord can terminate immediately for any lease violation.\",\n      \"concerns\": [\n        \"The immediate termination clause could lead to sudden eviction.\"\n      ]\n    },\n    {\n      \"title\": \"Liability and Insurance\",\n      \"riskLevel\": \"high\",\n      \"summary\": \"The Tenant must have renter's insurance of at least $100,000. The Landlord is not liable for theft or injury on the property.\",\n      \"concerns\": [\n        \"The liability waiver may leave the Tenant unprotected in certain situations.\"\n      ]\n    }\n  ]\n}",
[0]         "refusal": null,
[0]         "annotations": []
[0]       },
[0]       "logprobs": null,
[0]       "finish_reason": "stop"
[0]     }
[0]   ],
[0]   "usage": {
[0]     "prompt_tokens": 792,
[0]     "completion_tokens": 828,
[0]     "total_tokens": 1620,
[0]     "prompt_tokens_details": {
[0]       "cached_tokens": 0,
[0]       "audio_tokens": 0
[0]     },
[0]     "completion_tokens_details": {
[0]       "reasoning_tokens": 0,
[0]       "audio_tokens": 0,
[0]       "accepted_prediction_tokens": 0,
[0]       "rejected_prediction_tokens": 0
[0]     }
[0]   },
[0]   "service_tier": "default",
[0]   "system_fingerprint": "fp_34a54ae93c"
[0] }
[0] ğŸ¤– OpenAI Response received:
[0]    - Model used: gpt-4o-mini-2024-07-18
[0]    - Tokens used: 1620 (input: 792, output: 828)
[0]    - Response length: 3621 characters
[0] ğŸ“Š Analysis Results:
[0]    - Overall Risk: moderate
[0]    - Summary length: 293 chars
[0]    - Key findings: 3 categories
[0]    - Sections analyzed: 8
[0]    - Summary preview: "This document is a Residential Lease Agreement between Sunset Properties LLC and the Tenant for an apartment in Portland, Oregon. It outlines the terms of the lease, including rent, responsibilities f"
[0] ğŸ“Š Routing anonymous usage tracking through collective free tier user with individual tracking
[0] [Admin Detection] Not admin email: collective.free.tier@internal.system for user: 00000000-0000-0000-0000-000000000001
[0] [Subscription Enforcement] Valid subscription: Free tier assigned
[0] âœ… Usage tracked for collective free tier (00000000-0000-0000-0000-000000000001): +1 document, +1620 tokens, +$0.000535
[0] âœ… Document analysis completed successfully
[0] [Priority Queue] Completed free tier request in 21379ms
[0] ğŸ“‹ Using standard analysis result
[0] âœ… Document 1 analysis updated in session c30b06c17a628a7bb85d25aaff947893
[0] ğŸ’¾ Saved analysis type: object, keys: summary, overallRisk, keyFindings, sections
[0] âœ… Document 1 analysis completed for free tier user
[0] ğŸ“– Get document request: DocumentID=1, SessionID=c30b06c17a628a7bb85d25aaff947893
[0] ğŸ“‹ Retrieved document 1: hasAnalysis=true, analysisType=object
[0] ğŸ“‹ Analysis keys: summary, overallRisk, keyFindings, sections
[0] âœ… Document 1 found and returned (GET)
[0] ğŸ“Š Document analysis status: Present
[0] ğŸ“Š Analysis type: object, keys: summary, overallRisk, keyFindings, sections
[0] ğŸ“Š Session-based user detected (anonymous), providing free tier without subscription record
[0] ğŸ“Š Individual anonymous user (anonymous) usage: 0 documents analyzed this month
[0] ğŸ” Looking up user for email: admin@readmyfineprint.com
[0] âœ… Found user by direct email lookup
[0] [Admin Detection] Recognized known admin user ID: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Check] User c970c8a1-3a9d-43e0-b758-e5092db524ff admin status: true
[0] [Admin Access] Providing ultimate tier for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Setup] Admin user already has ultimate tier subscription
[0] [Admin Access] Returning ultimate tier (Ultimate) for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Generated verification code for admin@readmyfineprint.com (expires: 2025-08-04T00:17:19.710Z)
[0] âœ… Email sent successfully: {
[0]   messageId: '<b720edef-0397-a86f-0158-a80682b4c966@readmyfineprint.com>',
[0]   recipient: 'admin@readmyfineprint.com',
[0]   subject: 'ğŸ” Your ReadMyFinePrint Verification Code'
[0] }
[0] âœ… Verification email sent successfully to admin@readmyfineprint.com
[0] ğŸ“§ Verification code sent to admin@readmyfineprint.com
[2] 
[2] ğŸ” Production Health Check - 2025-08-04T00:07:38.366Z
[2] ğŸŒ Environment: staging
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] âœ… SERVER: Server responding normally
[2] âœ… DATABASE: Server responding normally
[0] âœ… Email configuration test successful
[2] âœ… EMAIL: Email service configured and ready
[2] âœ… PROCESSES: 27 server processes running
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] Overall Status: âœ… HEALTHY
[0] âœ… Email verification cleanup completed
[0] âœ… Email verification successful for admin@readmyfineprint.com
[0] ğŸ” Looking up user for email: admin@readmyfineprint.com
[0] âœ… Found user by direct email lookup
[0] [Admin Detection] Recognized known admin user ID: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Check] User c970c8a1-3a9d-43e0-b758-e5092db524ff admin status: true
[0] [Admin Access] Providing ultimate tier for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Setup] Admin user already has ultimate tier subscription
[0] [Admin Access] Returning ultimate tier (Ultimate) for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Generated JOSE token pair for user c970c8a1-3a9d-43e0-b758-e5092db524ff (access: 15min, refresh: 7d)
[0] â„¹ï¸ [SECURITY] AUTHENTICATION | LOW | 7bbecde6 | JOSE token pair generated | token-generation | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","secretVersion":1,"accessExpiry":"2025-08-04T00:22:42.000Z","refreshExpiry":"2025-08-11T00:07:42.000Z"}
[0] Stored session token mapping in PostgreSQL: e6733200-a139-4538-98c8-fe48ca173d85 -> eyJhbGci... (user: c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Email verification login successful: {
[0]   userId: 'c970c8a1-3a9d-43e0-b758-e5092db524ff',
[0]   email: 'admin@readmyfineprint.com',
[0]   sessionId: 'e6733200...',
[0]   accessTokenPrefix: 'eyJhbGciOiJIUzI1...',
[0]   cookieSettings: {
[0]     httpOnly: true,
[0]     secure: false,
[0]     sameSite: 'lax',
[0]     path: '/',
[0]     maxAge: 604800000
[0]   }
[0] }
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 7bbecde6 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 7bbecde6 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 7bbecde6 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 7bbecde6 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 7bbecde6 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 7bbecde6 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Checking session-based authentication...
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ” Checking session-based authentication...
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] ğŸ” JOSE token validation - token prefix: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...
[0] ğŸ” JOSE token validation - using secret key length: 32 bytes
[0] ğŸ” Current JWT secret version: 1
[0] âŒ JOSE token validation failed: unexpected "aud" claim value
[0] âŒ Token being validated: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
[0] âŒ Secret key details: { length: 32, keyPrefix: '2940caed' }
[0] ğŸ”„ Attempting token validation with fresh initialization...
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] âŒ Token validation failed even after re-initialization: unexpected "aud" claim value
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] ğŸ” JOSE token validation - token prefix: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...
[0] ğŸ” JOSE token validation - using secret key length: 32 bytes
[0] ğŸ” Current JWT secret version: 1
[0] âŒ JOSE token validation failed: unexpected "aud" claim value
[0] âŒ Token being validated: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
[0] âŒ Secret key details: { length: 32, keyPrefix: '2940caed' }
[0] ğŸ”„ Attempting token validation with fresh initialization...
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] âŒ Token validation failed even after re-initialization: unexpected "aud" claim value
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] ğŸ§¹ Cleaned up invalid session token in auth middleware
[0] ğŸ§¹ Cleaned up invalid session token in auth middleware
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e6733200...',
[0]   clientSessionId: 'c30b06c1...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] [Admin Detection] User not found: e6733200-a139-4538-98c8-fe48ca173d85
[0] [Admin Check] User e6733200-a139-4538-98c8-fe48ca173d85 admin status: false
[0] Creating inactive free tier subscription for user: e6733200-a139-4538-98c8-fe48ca173d85
[0] Creating inactive free tier subscription for user: e6733200-a139-4538-98c8-fe48ca173d85
[0] User e6733200-a139-4538-98c8-fe48ca173d85 not found in database, creating user record
[0] â„¹ï¸ [SECURITY] SUBSCRIPTION_CREATED | LOW | 6adb719d | Inactive free tier subscription created for user e6733200-a139-4538-98c8-fe48ca173d85 | subscription-service | {"userId":"e6733200-a139-4538-98c8-fe48ca173d85","tierId":"free","status":"inactive"}
[0] [Admin Detection] Not admin email: session-e6733200@temp.local for user: e6733200-a139-4538-98c8-fe48ca173d85
[0] [Subscription Enforcement] Valid subscription: Free tier assigned