â„¹ï¸ [SECURITY] SESSION_MANAGEMENT | LOW | 0ea1a0cb | New session created
ğŸ“ New session logged for client: c39951fa0aedc9446f49f81bfd55c920
ğŸ“ Processing TEST webhook event
ğŸ“ Webhook checkout.session.completed received (TEST):
   Session ID: cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy
   Mode: subscription
   Payment Status: paid
   Subscription ID: sub_1RcylsPxX1dXZoQGF6f6ZQry
   Customer ID: cus_SY4vhZAc40vkfi
   Metadata: {
  tierId: 'starter',
  billingCycle: 'yearly',
  userId: 'c9a968a66ad04cb9385540c8928e245a'
}
ğŸ‰ Processing subscription checkout (TEST): cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy
ğŸ“‹ Extracted data: tierId=starter, userId=c9a968a66ad04cb9385540c8928e245a, customerId=cus_SY4vhZAc40vkfi, subscriptionId=sub_1RcylsPxX1dXZoQGF6f6ZQry
ğŸš€ Starting subscription creation process...
ğŸ‘¤ User c9a968a66ad04cb9385540c8928e245a not found in database, creating subscription user
ğŸ“§ Using customer email for missing user: beatsbybuddha@gmail.com
Created subscription user 24c3ec47-dd61-4619-9c9e-18abbd0981ea for Stripe customer cus_SY4vhZAc40vkfi
ğŸ‘¤ Created missing user: 24c3ec47-dd61-4619-9c9e-18abbd0981ea for customer cus_SY4vhZAc40vkfi
Created subscription 61655720-46c7-4267-b153-16b73bd525a9 for user 24c3ec47-dd61-4619-9c9e-18abbd0981ea
(node:24428) [DEP0106] DeprecationWarning: crypto.createCipher is deprecated.
(Use `node --trace-deprecation ...` to show where the warning was created)
Stored subscription token in Replit DB: sub_e205bd39149b...
Generated secure subscription token for user 24c3ec47-dd61-4619-9c9e-18abbd0981ea (expires in 30 days)
ğŸ’¾ Storing session token mapping...
Stored session token mapping: cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy -> sub_e205... (encrypted: true)
Stored session token mapping for session cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy
ğŸ” Verifying token storage...
Converting legacy object format for session: cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy
ğŸ” Legacy object data structure: {"ok":false,"error":{"message":"invalid token","statusCode":403}}
ğŸ” Legacy object properties: [ 'ok', 'error', 'errorExtras' ]
âŒ Invalid legacy object format for session cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy:
   Expected: {token: string, expiresAt: string}
   Received: {
  ok: false,
  error: { message: 'invalid token', statusCode: 403 },
  errorExtras: undefined
}
   Type: object
   Keys: [ 'ok', 'error', 'errorExtras' ]
ğŸ§¹ Cleaning up corrupted data...
âŒ Token storage failed: No token found after storage attempt
âœ… Subscription created successfully:
   User ID: 24c3ec47-dd61-4619-9c9e-18abbd0981ea
   Subscription ID: 61655720-46c7-4267-b153-16b73bd525a9
   Token: sub_e205...
   Checkout Session: cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy
â„¹ï¸ [SECURITY] API_ACCESS | LOW | 0ea1a0cb | Subscription created: sub_1RcylsPxX1dXZoQGF6f6ZQry (TEST mode) | /api/stripe-webhook | {"subscriptionId":"sub_1RcylsPxX1dXZoQGF6f6ZQry","customerId":"cus_SY4vhZAc40vkfi","tierId":"starter","billingCycle":"yearly","testMode":true}
1:02:06 AM [express] POST /api/stripe-webhook 200 in 968ms :: {"received":true}
â„¹ï¸ [SECURITY] SESSION_MANAGEMENT | LOW | b1c859b2 | New session created
ğŸ“ New session logged for client: f7a341d6389cb9365c04f6e583a6a3c8
ğŸ”‡ Session logging suppressed for client (cooldown: 165ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 214ms)
â„¹ï¸ [SECURITY] SESSION_MANAGEMENT | LOW | 5948a372 | New session created
ğŸ“ New session logged for client: 63e4a8f4f7aadc2399481168731fa843
ğŸ”‡ Session logging suppressed for client (cooldown: 232ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 55ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 281ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 160ms)
â„¹ï¸ [SECURITY] SESSION_MANAGEMENT | LOW | 7e3ab120 | New session created
ğŸ“ New session logged for client: 8e5532caa00407ad0da3ba14227a656c
ğŸ”‡ Session logging suppressed for client (cooldown: 389ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 2ms)
â„¹ï¸ [SECURITY] SESSION_MANAGEMENT | LOW | dca67e37 | New session created
ğŸ“ New session logged for client: 8d6e3e5471aa18ae323dbfbbe4b155d1
ğŸ”‡ Session logging suppressed for client (cooldown: 201ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 48ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 437ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 50ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 51ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 249ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 488ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 99ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 102ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 102ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 507ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 299ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 537ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 150ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 150ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 149ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 555ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 345ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 587ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 200ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 202ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 201ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 599ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 388ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 250ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 249ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 251ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 640ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 651ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 438ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 690ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 303ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 303ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 302ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 695ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 486ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 350ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 741ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 354ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 742ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 355ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 534ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 402ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 400ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 791ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 792ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 406ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 579ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 840ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 453ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 452ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 458ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 847ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 627ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 501ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 890ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 682ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 926ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 1436ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 1264ms)
ğŸ”‡ Session logging suppressed for client (cooldown: 3890ms)
ğŸ” Token retrieval request for session: cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy
Converting legacy object format for session: cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy
ğŸ” Legacy object data structure: {"ok":false,"error":{"message":"invalid token","statusCode":403}}
ğŸ” Legacy object properties: [ 'ok', 'error', 'errorExtras' ]
âŒ Invalid legacy object format for session cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy:
   Expected: {token: string, expiresAt: string}
   Received: {
  ok: false,
  error: { message: 'invalid token', statusCode: 403 },
  errorExtras: undefined
}
   Type: object
   Keys: [ 'ok', 'error', 'errorExtras' ]
ğŸ§¹ Cleaning up corrupted data...
ğŸ”‘ Token lookup result: not found
âŒ No token found for session: cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKzaNhPtO3FXvuBhy
ğŸ’³ Found paid Stripe session but no token - webhook may not have processed yet
1:02:12 AM [express] GET /api/subscription/token/cs_test_a11gQNRpwAlZNfKotNBgzWie8qFNpbvKb7oOcNWx6XKâ€¦