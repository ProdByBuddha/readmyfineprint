> readmyfineprint@2.0.0 start:staging
> NODE_ENV=staging concurrently "tsx server/production.ts" "node scripts/local-llm-server.cjs" "npm run monitor:continuous"

[1] ğŸš€ Local LLM server running on port 11434
[1] ğŸ“¡ Compatible with Ollama API endpoints
[1] ğŸ” Ready for PII detection requests
[1] ğŸ›‘ Press Ctrl+C to stop
[2] 
[2] > readmyfineprint@2.0.0 monitor:continuous
[2] > node scripts/production-monitor.js --continuous
[2] 
[2] ğŸš€ Production Monitor initialized for staging environment
[2] ğŸ“§ Email alerts enabled for: prodbybuddha@icloud.com
[2] ğŸš€ Starting continuous production monitoring...
[2] ğŸ“Š Environment: staging
[2] â° Check interval: 120 seconds
[2] Press Ctrl+C to stop
[2] 
[[0] âœ“ Consent logging enabled with PostgreSQL database.
[0] âœ… JWT Secret Manager initialized with versioned secrets
[0] Blog Scheduler initialized with config: {
[0]   enabled: false,
[0]   postsPerDay: 3,
[0]   hours: [ 9, 13, 17 ],
[0]   maxPostsPerHour: 1,
[0]   timezone: 'America/New_York',
[0]   minHoursBetweenPosts: 4
[0] }
[0] ğŸ“‹ Initialized 4 disaster recovery scenarios
[0] ğŸ” Started continuous health monitoring
[0] ğŸ”‘ Using Stripe key: sk_live_51RWnyY... (test mode: false)
[0] ğŸš€ Starting ReadMyFinePrint Production Server...
[0] ğŸ” Validating environment variables...
[0] âœ… OPENAI_API_KEY: sk-***
[0] âœ… ADMIN_API_KEY: 81ad52472ab148577fb4ba109d09901d1e9b5d55479ccebbea...
[0] âœ… JWT_SECRET: KQvWGiKq5jAfsTSHFID1StgprPQAusDKhJmSdVFKgZI5W/nF2O...
[0] âœ… TOKEN_ENCRYPTION_KEY: ddf455b6fd8c0e59d5893bf44e7bca157c0ad51405258c7bee...
[0] âœ… PASSWORD_PEPPER: b0dea38aca02ad50d94b704f127740decf0e4839b66c6f145d...
[0] âœ… ALLOWED_ORIGINS: https://readmyfineprint.com,https://edcf3ef7-a826-...
[0] âœ… NODE_ENV: staging
[0] âœ… SESSION_ENCRYPTION_KEY: 2651fc8605cabc8b756adbc6861138afe8cf520d54417763ee...
[0] âœ… REPLIT_DB_URL: https://kv.replit.com/v0/eyJhbGciOiJIUzUxMiIsImlzc...
[0] ğŸš§ Running in staging environment
[0] âœ… STRIPE_PUBLIC_KEY: pk_live_51RWnyYLNxaR...
[0] âœ… STRIPE_SECRET_KEY: sk_live_51...
[0] âœ… STRIPE_TEST_PUBLIC_KEY: pk_test_51RWnynPxX1d...
[0] âœ… STRIPE_TEST_SECRET_KEY: sk_test_51...
[0] ğŸ”„ Concurrent test/live payment processing enabled
[0] 
[0] ğŸ“‹ Warnings:
[0]    âš ï¸  Optional SECURITY_WEBHOOK_URL not set - Optional webhook URL for security alerts (for external monitoring)
[0] âœ… Environment validation passed
[0]    (1 warning)
[0] 
[0] ğŸ”§ Environment Configuration:
[0]    Environment: staging
[0]    OpenAI API: âœ… Configured
[0]    Admin Auth: âœ… Configured
[0]    CORS Origins: https://readmyfineprint.com,https://edcf3ef7-a826-4eed-8e04-7a485b2e183a-00-1wyt...
[0] 
[0] âœ… Secure JWT Service initialized with refresh token support
[0] Warning: Indexing all PDF objects
[0] ğŸ“… Backup schedules configured
[0] âœ… Backup service initialized with automated scheduling
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | caf37866 | JWT Secret Manager initialized successfully | initialization
[0] ğŸ” Checking database migrations...
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | f15f50b0 | Secure JWT Service initialized | initialization
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1f81d322 | Backup service initialized successfully | initialization
[0] âœ… Email service configured and verified with SMTP (smtp.mail.me.com)
[0] âœ… Database schema is up to date
[0] âœ… Two-Factor Authentication routes registered
[0] ğŸ“‹ Production server running on http://0.0.0.0:5000
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Checking session-based authentication...
[0] Consent verification request - IP: 10.82.5.55, UA: Mozilla/5.0 (Windows..., User: none, Session: 95df0cd7498a5b0900375af079720126
[0] Generated pseudonym 905c19b33c072b9392497ff4 from identifier: session:95df0cd7498a5b0900375af079720126...
[0] Verifying consent for pseudonym: 905c19b33c072b9392497ff4 (IP: 10.82.5.55, UA: Mozilla/5.0 (Windows..., User: none, Session: 95df0cd7498a5b09)
[0] ğŸ” Checking session-based authentication...
[0] Consent verification result for 905c19b33c072b9392497ff4: false 
[0] Consent verification response: false (session: 95df0cd7498a5b0900375af079720126)
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 4fc40739 | Failed authentication attempt: Authentication required | /api/security-questions/user | {"reason":"Authentication required"}
[0] ğŸ” Checking session-based authentication...
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 4fc40739 | Failed authentication attempt: Authentication required | /api/security-questions/user | {"reason":"Authentication required"}
[0] ğŸ” Checking session-based authentication...
[0] Consent verification request - IP: 10.82.5.55, UA: Mozilla/5.0 (Windows..., User: none, Session: 95df0cd7498a5b0900375af079720126
[0] Generated pseudonym 905c19b33c072b9392497ff4 from identifier: session:95df0cd7498a5b0900375af079720126...
[0] Verifying consent for pseudonym: 905c19b33c072b9392497ff4 (IP: 10.82.5.55, UA: Mozilla/5.0 (Windows..., User: none, Session: 95df0cd7498a5b09)
[0] Using cached consent result for 905c19b33c072b9392497ff4: false
[0] Consent verification response: false (session: 95df0cd7498a5b0900375af079720126)
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 4fc40739 | Failed authentication attempt: Authentication required | /api/security-questions/user | {"reason":"Authentication required"}
[0] Consent verification request - IP: 10.82.9.65, UA: Mozilla/5.0 (Windows..., User: none, Session: 95df0cd7498a5b0900375af079720126
[0] Generated pseudonym 905c19b33c072b9392497ff4 from identifier: session:95df0cd7498a5b0900375af079720126...
[0] Verifying consent for pseudonym: 905c19b33c072b9392497ff4 (IP: 10.82.9.65, UA: Mozilla/5.0 (Windows..., User: none, Session: 95df0cd7498a5b09)
[0] Using cached consent result for 905c19b33c072b9392497ff4: false
[0] Consent verification response: false (session: 95df0cd7498a5b0900375af079720126)
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] âœ… JOSE Auth Service initialized with key length: 32 bytes
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | b4080c56 | JOSE Auth Service initialized | initialization
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 58201d79 | Failed authentication attempt: Authentication required | /api/security-questions/user | {"reason":"Authentication required"}
[0] ğŸ” Checking session-based authentication...
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: 'e94ba229...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] Consent verification request - IP: 10.82.3.98, UA: Mozilla/5.0 (Windows..., User: c970c8a1-3a9d-43e0-b758-e5092db524ff, Session: e94ba2291aaf74cf0ecdcb4e9bd58850
[0] Generated pseudonym 640a3f32e1423e43fbfa24e3 from identifier: user:c970c8a1-3a9d-43e0-b758-e5092db524ff...
[0] Verifying consent for pseudonym: 640a3f32e1423e43fbfa24e3 (IP: 10.82.3.98, UA: Mozilla/5.0 (Windows..., User: c970c8a1-3a9d-43e0-b758-e5092db524ff, Session: e94ba2291aaf74cf)
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] Consent verification result for 640a3f32e1423e43fbfa24e3: true (ID: 62f3f73841ebc622f4f67b94)
[0] Consent verification response: true (session: e94ba2291aaf74cf0ecdcb4e9bd58850)
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: 'e94ba229...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: 'e94ba229...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 4fc40739 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: 'e94ba229...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 4fc40739 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: 'e94ba229...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 4fc40739 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Checking session-based authentication...
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | 4fc40739 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: '95df0cd7...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] ğŸ§¹ Cleaned up 0 expired refresh tokens and 0 expired revocations
[0] Session cleanup completed: 0 expired sessions removed
[0] ğŸ§¹ Startup cleanup: 0 expired tokens removed, 0 expired sessions removed
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] Consent logging request - IP: 10.82.3.98, UA: Mozilla/5.0 (Windows..., User: c970c8a1-3a9d-43e0-b758-e5092db524ff, Session: e94ba2291aaf74cf0ecdcb4e9bd58850
[0] Logging consent - IP: 10.82.3.98, UA: Mozilla/5.0 (Windows..., User: c970c8a1-3a9d-43e0-b758-e5092db524ff, Session: e94ba2291aaf74cf0ecdcb4e9bd58850
[0] Generated pseudonym 640a3f32e1423e43fbfa24e3 from identifier: user:c970c8a1-3a9d-43e0-b758-e5092db524ff...
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[2] 
[2] ğŸ” Production Health Check - 2025-08-03T20:52:01.408Z
[2] ğŸŒ Environment: staging
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] âœ… SERVER: Server responding normally
[2] âœ… DATABASE: Server responding normally
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] Consent verification request - IP: 10.82.3.98, UA: Mozilla/5.0 (Windows..., User: c970c8a1-3a9d-43e0-b758-e5092db524ff, Session: e94ba2291aaf74cf0ecdcb4e9bd58850
[0] Generated pseudonym 640a3f32e1423e43fbfa24e3 from identifier: user:c970c8a1-3a9d-43e0-b758-e5092db524ff...
[0] Verifying consent for pseudonym: 640a3f32e1423e43fbfa24e3 (IP: 10.82.3.98, UA: Mozilla/5.0 (Windows..., User: c970c8a1-3a9d-43e0-b758-e5092db524ff, Session: e94ba2291aaf74cf)
[0] Using cached consent result for 640a3f32e1423e43fbfa24e3: true
[0] Consent verification response: true (session: e94ba2291aaf74cf0ecdcb4e9bd58850)
[0] âœ… Email configuration test successful
[2] âœ… EMAIL: Email service configured and ready
[2] âœ… PROCESSES: 27 server processes running
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] Overall Status: âœ… HEALTHY
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ” Checking session-based authentication...
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: 'e94ba229...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: 'e94ba229...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] Creating inactive free tier subscription for user: 910a698b-d13e-4b53-9e58-34c218677c2f
[0] Error getting user subscription: DrizzleQueryError: Failed query: insert into "user_subscriptions" ("id", "user_id", "tier_id", "status", "stripe_customer_id", "stripe_subscription_id", "current_period_start", "current_period_end", "cancel_at_period_end", "created_at", "updated_at") values (default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10) returning "id", "user_id", "tier_id", "status", "stripe_customer_id", "stripe_subscription_id", "current_period_start", "current_period_end", "cancel_at_period_end", "created_at", "updated_at"
[0] params: 910a698b-d13e-4b53-9e58-34c218677c2f,free,inactive,,,2025-08-03T20:52:06.928Z,2026-08-03T20:52:06.928Z,false,2025-08-03T20:52:06.928Z,2025-08-03T20:52:06.928Z
[0]     at PostgresJsPreparedQuery.queryWithCache (/home/runner/workspace/node_modules/src/pg-core/session.ts:73:11)
[0]     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
[0]     at async <anonymous> (/home/runner/workspace/node_modules/src/postgres-js/session.ts:58:17)
[0]     at async DatabaseStorage.createUserSubscription (/home/runner/workspace/server/database-storage.ts:259:28)
[0]     at async SubscriptionService.createInactiveFreeSubscription (/home/runner/workspace/server/subscription-service.ts:838:33)
[0]     at async SubscriptionService.ensureUserHasSubscription (/home/runner/workspace/server/subscription-service.ts:901:14)
[0]     at async SubscriptionService.getUserSubscriptionWithUsage (/home/runner/workspace/server/subscription-service.ts:484:24)
[0]     at async <anonymous> (/home/runner/workspace/server/routes.ts:1637:26) {
[0]   query: 'insert into "user_subscriptions" ("id", "user_id", "tier_id", "status", "stripe_customer_id", "stripe_subscription_id", "current_period_start", "current_period_end", "cancel_at_period_end", "created_at", "updated_at") values (default, $1, $2, $3, $4, $5, $6, $7, $8, $9, $10) returning "id", "user_id", "tier_id", "status", "stripe_customer_id", "stripe_subscription_id", "current_period_start", "current_period_end", "cancel_at_period_end", "created_at", "updated_at"',
[0]   params: [
[0]     '910a698b-d13e-4b53-9e58-34c218677c2f',
[0]     'free',
[0]     'inactive',
[0]     null,
[0]     null,
[0]     '2025-08-03T20:52:06.928Z',
[0]     '2026-08-03T20:52:06.928Z',
[0]     false,
[0]     '2025-08-03T20:52:06.928Z',
[0]     '2025-08-03T20:52:06.928Z'
[0]   ],
[0]   cause: PostgresError: insert or update on table "user_subscriptions" violates foreign key constraint "user_subscriptions_user_id_fkey"
[0]       at ErrorResponse (file:///home/runner/workspace/node_modules/postgres/src/connection.js:794:26)
[0]       at handle (file:///home/runner/workspace/node_modules/postgres/src/connection.js:480:6)
[0]       at TLSSocket.data (file:///home/runner/workspace/node_modules/postgres/src/connection.js:315:9)
[0]       at TLSSocket.emit (node:events:524:28)
[0]       at addChunk (node:internal/streams/readable:561:12)
[0]       at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
[0]       at Readable.push (node:internal/streams/readable:392:5)
[0]       at TLSWrap.onStreamRead (node:internal/stream_base_commons:191:23) {
[0]     severity_local: 'ERROR',
[0]     severity: 'ERROR',
[0]     code: '23503',
[0]     detail: 'Key (user_id)=(910a698b-d13e-4b53-9e58-34c218677c2f) is not present in table "users".',
[0]     schema_name: 'public',
[0]     table_name: 'user_subscriptions',
[0]     constraint_name: 'user_subscriptions_user_id_fkey',
[0]     file: 'ri_triggers.c',
[0]     line: '2608',
[0]     routine: 'ri_ReportViolation'
[0]   }
[0] }
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: 'e94ba229...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Session validation request: {
[0]   sessionId: '910a698b...',
[0]   clientSessionId: 'e94ba229...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ” Admin auth attempt for /api/admin/system-health-subscription
[0] ğŸ” Admin auth attempt for /api/admin/metrics-subscription
[0] ğŸ” Admin auth attempt for /api/admin/activity-subscription
[0] ğŸ” Session auth failed, trying traditional admin auth for /api/admin/metrics-subscription
[0] ğŸ” Session auth failed, trying traditional admin auth for /api/admin/system-health-subscription
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | e1720fdb | Failed authentication attempt: Missing admin credentials and no valid session | /api/admin/metrics-subscription | {"reason":"Missing admin credentials and no valid session"}
[0] ğŸ” Session auth failed, trying traditional admin auth for /api/admin/activity-subscription
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 58201d79 | Failed authentication attempt: Missing admin credentials and no valid session | /api/admin/system-health-subscription | {"reason":"Missing admin credentials and no valid session"}
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 4fc40739 | Failed authentication attempt: Missing admin credentials and no valid session | /api/admin/activity-subscription | {"reason":"Missing admin credentials and no valid session"}
[0] âœ… Refreshed JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Refreshed JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] â„¹ï¸ [SECURITY] AUTHENTICATION | LOW | 58201d79 | Access token refreshed | token-refresh | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","secretVersion":1,"accessExpiry":"2025-08-03T21:07:13.000Z"}
[0] â„¹ï¸ [SECURITY] AUTHENTICATION | LOW | e1720fdb | Access token refreshed | token-refresh | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","secretVersion":1,"accessExpiry":"2025-08-03T21:07:13.000Z"}
[0] âœ… Refreshed JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] â„¹ï¸ [SECURITY] AUTHENTICATION | LOW | 4fc40739 | Access token refreshed | token-refresh | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","secretVersion":1,"accessExpiry":"2025-08-03T21:07:13.000Z"}
[0] ğŸ” Admin auth attempt for /api/admin/metrics-subscription
[0] ğŸ” Admin auth attempt for /api/admin/system-health-subscription
[0] ğŸ” Admin auth attempt for /api/admin/activity-subscription
[0] ğŸ” Session auth failed, trying traditional admin auth for /api/admin/system-health-subscription
[0] ğŸ” Session auth failed, trying traditional admin auth for /api/admin/metrics-subscription
[0] ğŸ” Session auth failed, trying traditional admin auth for /api/admin/activity-subscription
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | e1720fdb | Failed authentication attempt: Missing admin credentials and no valid session | /api/admin/system-health-subscription | {"reason":"Missing admin credentials and no valid session"}
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 58201d79 | Failed authentication attempt: Missing admin credentials and no valid session | /api/admin/metrics-subscription | {"reason":"Missing admin credentials and no valid session"}
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 4fc40739 | Failed authentication attempt: Missing admin credentials and no valid session | /api/admin/activity-subscription | {"reason":"Missing admin credentials and no valid session"}
[0] ğŸ” Admin auth attempt for /api/admin/system-health-subscription
[0] ğŸ” Session auth failed, trying traditional admin auth for /api/admin/system-health-subscription
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 4fc40739 | Failed authentication attempt: Missing admin credentials and no valid session | /api/admin/system-health-subscription | {"reason":"Missing admin credentials and no valid session"}
[0] âœ… Refreshed JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] â„¹ï¸ [SECURITY] AUTHENTICATION | LOW | 4fc40739 | Access token refreshed | token-refresh | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","secretVersion":1,"accessExpiry":"2025-08-03T21:07:20.000Z"}
[0] ğŸ” Admin auth attempt for /api/admin/system-health-subscription
[0] ğŸ” Session auth failed, trying traditional admin auth for /api/admin/system-health-subscription
[0] âš ï¸ [SECURITY] AUTHENTICATION | HIGH | 4fc40739 | Failed authentication attempt: Missing admin credentials and no valid session | /api/admin/system-health-subscription | {"reason":"Missing admin credentials and no valid session"}