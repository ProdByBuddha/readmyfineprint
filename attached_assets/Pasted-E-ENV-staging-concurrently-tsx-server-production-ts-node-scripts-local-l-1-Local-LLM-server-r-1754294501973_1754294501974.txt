E_ENV=staging concurrently "tsx server/production.ts" "node scripts/local-l[1] ğŸš€ Local LLM server running on port 11434
[1] ğŸ“¡ Compatible with Ollama API endpoints
[1] ğŸ” Ready for PII detection requests
[1] ğŸ›‘ Press Ctrl+C to stop
[2] 
[2] > readmyfineprint@2.0.0 monitor:continuous
[2] > node scripts/production-monitor.js --continuous
[2] 
[2] ğŸš€ Production Monitor initialized for staging environment
[2] ğŸ“§ Email alerts enabled for: prodbybuddha@icloud.com
[2] ğŸš€ Starting continuous production monitoring...
[2] ğŸ“Š Environment: staging
[2] â° Check interval: 120 seconds
[2] Press Ctrl+C to stop
[2] 
[2] â³ Waiting 15 seconds for staging server to start...
[0] âœ“ Consent logging enabled with PostgreSQL database
[0] Blog Scheduler initialized with config: {
[0]   enabled: false,
[0]   postsPerDay: 3,
[0]   hours: [ 9, 13, 17 ],
[0]   maxPostsPerHour: 1,
[0]   timezone: 'America/New_York',
[0]   minHoursBetweenPosts: 4
[0] }
[0] âœ… JWT Secret Manager initialized with versioned secrets
[0] ğŸ“‹ Initialized 4 disaster recovery scenarios
[0] ğŸ” Started continuous health monitoring
[0] ğŸ”‘ Using Stripe key: sk_live_51RWnyY... (test mode: false)
[0] ğŸš€ Starting ReadMyFinePrint Production Server...
[0] ğŸ” Validating environment variables...
[0] âœ… OPENAI_API_KEY: sk-***
[0] âœ… ADMIN_API_KEY: 81ad52472ab148577fb4ba109d09901d1e9b5d55479ccebbea...
[0] âœ… JWT_SECRET: KQvWGiKq5jAfsTSHFID1StgprPQAusDKhJmSdVFKgZI5W/nF2O...
[0] âœ… TOKEN_ENCRYPTION_KEY: ddf455b6fd8c0e59d5893bf44e7bca157c0ad51405258c7bee...
[0] âœ… PASSWORD_PEPPER: b0dea38aca02ad50d94b704f127740decf0e4839b66c6f145d...
[0] âœ… ALLOWED_ORIGINS: https://readmyfineprint.com,https://edcf3ef7-a826-...
[0] âœ… NODE_ENV: staging
[0] âœ… SESSION_ENCRYPTION_KEY: 2651fc8605cabc8b756adbc6861138afe8cf520d54417763ee...
[0] âœ… REPLIT_DB_URL: https://kv.replit.com/v0/eyJhbGciOiJIUzUxMiIsImlzc...
[0] ğŸš§ Running in staging environment
[0] âœ… STRIPE_PUBLIC_KEY: pk_live_51RWnyYLNxaR...
[0] âœ… STRIPE_SECRET_KEY: sk_live_51...
[0] âœ… STRIPE_TEST_PUBLIC_KEY: pk_test_51RWnynPxX1d...
[0] âœ… STRIPE_TEST_SECRET_KEY: sk_test_51...
[0] ğŸ”„ Concurrent test/live payment processing enabled
[0] 
[0] ğŸ“‹ Warnings:
[0]    âš ï¸  Optional SECURITY_WEBHOOK_URL not set - Optional webhook URL for security alerts (for external monitoring)
[0] âœ… Environment validation passed
[0]    (1 warning)
[0] 
[0] ğŸ”§ Environment Configuration:
[0]    Environment: staging
[0]    OpenAI API: âœ… Configured
[0]    Admin Auth: âœ… Configured
[0]    CORS Origins: https://readmyfineprint.com,https://edcf3ef7-a826-4eed-8e04-7a485b2e183a-00-1wyt...
[0] 
[0] âœ… Secure JWT Service initialized with refresh token support
[0] Warning: Indexing all PDF objects
[0] ğŸ“… Backup schedules configured
[0] âœ… Backup service initialized with automated scheduling
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | caf37866 | JWT Secret Manager initialized successfully | initialization
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | f15f50b0 | Secure JWT Service initialized | initialization
[0] ğŸ” Checking database migrations...
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1f81d322 | Backup service initialized successfully | initialization
[0] âœ… Email service configured and verified with SMTP (smtp.mail.me.com)
[0] âœ… Database schema is up to date
[0] âœ… Two-Factor Authentication routes registered
[0] ğŸ” [Tier Monitor] Started periodic monitoring (every 30 minutes)
[0] ğŸ“‹ Production server running on http://0.0.0.0:5000
[0] ğŸ“‹ Production server running on http://0.0.0.0:5000
[0] ğŸ” [Startup] Running initial admin tier verification...
[0] [Admin Detection] Recognized known admin user ID: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Check] User c970c8a1-3a9d-43e0-b758-e5092db524ff admin status: true
[0] [Admin Access] Providing ultimate tier for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Setup] Admin user already has ultimate tier subscription
[0] [Admin Access] Returning ultimate tier (Ultimate) for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Detection] Recognized known admin user ID: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Detection] Recognized known admin user ID: 24c3ec47-dd61-4619-9c9e-18abbd0981ea
[0] [Admin Check] User 24c3ec47-dd61-4619-9c9e-18abbd0981ea admin status: true
[0] [Admin Access] Providing ultimate tier for admin user: 24c3ec47-dd61-4619-9c9e-18abbd0981ea
[0] [Admin Setup] Admin user already has ultimate tier subscription
[0] [Admin Access] Returning ultimate tier (Ultimate) for admin user: 24c3ec47-dd61-4619-9c9e-18abbd0981ea
[0] [Admin Detection] Recognized known admin user ID: 24c3ec47-dd61-4619-9c9e-18abbd0981ea
[0] ğŸ” [Tier Monitor] Checked 2 admin users, found 0 issues
[0] âœ… [Startup] All admin tier assignments verified correct
[0] âœ… JOSE Auth Service initialized with key length: 32 bytes
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | b4080c56 | JOSE Auth Service initialized | initialization
[0] JWT token expired: Token expired
[0] ğŸ” Checking session-based authentication...
[0] JWT token expired: Token expired
[0] ğŸ” Checking session-based authentication...
[0] ğŸ§¹ Cleaned up 0 expired refresh tokens and 0 expired revocations
[0] Session cleanup completed: 0 expired sessions removed
[0] ğŸ§¹ Startup cleanup: 0 expired tokens removed, 0 expired sessions removed
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] ğŸ” JOSE token validation - token prefix: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...
[0] ğŸ” JOSE token validation - using secret key length: 32 bytes
[0] ğŸ” Current JWT secret version: 1
[0] âŒ JOSE token validation failed: unexpected "aud" claim value
[0] âŒ Token being validated: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
[0] âŒ Secret key details: { length: 32, keyPrefix: '2940caed' }
[0] ğŸ”„ Attempting token validation with fresh initialization...
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] âŒ Token validation failed even after re-initialization: unexpected "aud" claim value
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e5c57112...',
[0]   clientSessionId: '7e4a49c9...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Attempting direct JWT validation as fallback...
[0] âŒ Direct JWT validation failed: Token expired
[0] ğŸ” Checking authenticated user session...
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] ğŸ” JOSE token validation - token prefix: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...
[0] ğŸ” JOSE token validation - using secret key length: 32 bytes
[0] ğŸ” Current JWT secret version: 1
[0] âŒ JOSE token validation failed: unexpected "aud" claim value
[0] âŒ Token being validated: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
[0] âŒ Secret key details: { length: 32, keyPrefix: '2940caed' }
[0] ğŸ”„ Attempting token validation with fresh initialization...
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] âŒ Token validation failed even after re-initialization: unexpected "aud" claim value
[0] Consent verification request - IP: 10.82.4.25, UA: Mozilla/5.0 (Macinto..., User: none, Session: 7e4a49c9eb04e17a3bfd6f30d46af46f
[0] Generated pseudonym 9aec8c33f8519175c0abc912 from identifier: session:7e4a49c9eb04e17a3bfd6f30d46af46f...
[0] Verifying consent for pseudonym: 9aec8c33f8519175c0abc912 (IP: 10.82.4.25, UA: Mozilla/5.0 (Macinto..., User: none, Session: 7e4a49c9eb04e17a)
[0] ğŸ” Token lookup result: { found: true, tokenPrefix: 'eyJhbGciOiJIUzI1...' }
[0] ğŸ” JOSE token validation - token prefix: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...
[0] ğŸ” JOSE token validation - using secret key length: 32 bytes
[0] ğŸ” Current JWT secret version: 1
[0] âŒ JOSE token validation failed: unexpected "aud" claim value
[0] âŒ Token being validated: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
[0] âŒ Secret key details: { length: 32, keyPrefix: '2940caed' }
[0] ğŸ”„ Attempting token validation with fresh initialization...
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] âŒ Token validation failed even after re-initialization: unexpected "aud" claim value
[0] ğŸ” Token validation result: { valid: false, userId: 'none', tierId: 'none' }
[0] âŒ Token validation failed
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] Consent verification result for 9aec8c33f8519175c0abc912: false 
[0] Consent verification response: false (session: 7e4a49c9eb04e17a3bfd6f30d46af46f)
[0] ğŸ§¹ Removed invalid token from database
[0] JWT token expired: Token expired
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e5c57112...',
[0]   clientSessionId: '7e4a49c9...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Attempting direct JWT validation as fallback...
[0] âŒ Direct JWT validation failed: Token expired
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] JWT token expired: Token expired
[0] ğŸ” Checking session-based authentication...
[0] âœ… Refreshed JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] â„¹ï¸ [SECURITY] AUTHENTICATION | LOW | a76e1095 | Access token refreshed | token-refresh | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","secretVersion":1,"accessExpiry":"2025-08-04T08:04:38.000Z"}
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e5c57112...',
[0]   clientSessionId: '7e4a49c9...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Attempting direct JWT validation as fallback...
[0] âŒ Direct JWT validation failed: Token expired
[0] ğŸ” Checking authenticated user session...
[0] ğŸ” Token lookup result: { found: false, tokenPrefix: 'none' }
[0] âŒ No token found for session
[0] âœ… Refreshed JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] â„¹ï¸ [SECURITY] AUTHENTICATION | LOW | fb67b495 | Access token refreshed | token-refresh | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","secretVersion":1,"accessExpiry":"2025-08-04T08:04:38.000Z"}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e5c57112...',
[0]   clientSessionId: '7e4a49c9...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Refreshed JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] â„¹ï¸ [SECURITY] AUTHENTICATION | LOW | a76e1095 | Access token refreshed | token-refresh | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","secretVersion":1,"accessExpiry":"2025-08-04T08:04:38.000Z"}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e5c57112...',
[0]   clientSessionId: '7e4a49c9...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e5c57112...',
[0]   clientSessionId: '7e4a49c9...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | a76e1095 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[2] 
[2] ğŸ” Production Health Check - 2025-08-04T07:49:39.756Z
[2] ğŸŒ Environment: staging
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] âœ… SERVER: Server responding normally
[2] âœ… DATABASE: Server responding normally
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | a76e1095 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Email configuration test successful
[2] âœ… EMAIL: Email service configured and ready
[2] âœ… PROCESSES: 31 server processes running
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] Overall Status: âœ… HEALTHY
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e5c57112...',
[0]   clientSessionId: '7e4a49c9...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: 'e5c57112...',
[0]   clientSessionId: '7e4a49c9...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ” Admin auth attempt for /api/admin/metrics-subscription
[0] ğŸ” Admin auth attempt for /api/admin/activity-subscription
[0] ğŸ” Admin auth attempt for /api/admin/system-health-subscription
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Admin access granted via JWT: admin@readmyfineprint.com
[0] ğŸ” [SECURITY] AUTHENTICATION | MEDIUM | a76e1095 | Admin authentication successful | /api/admin/metrics-subscription (JWT admin)
[0] âœ… Admin access granted via JWT: admin@readmyfineprint.com
[0] âœ… Admin access granted via JWT: admin@readmyfineprint.com
[0] ğŸ” [SECURITY] AUTHENTICATION | MEDIUM | a76e1095 | Admin authentication successful | /api/admin/activity-subscription (JWT admin)
[0] ğŸ” [SECURITY] AUTHENTICATION | MEDIUM | fb67b495 | Admin authentication successful | /api/admin/system-health-subscription (JWT admin)
[0] ğŸ” Checking session-based authentication...
[0] [Admin Detection] Not admin email: session-e5c57112@temp.local for user: e5c57112-0312-4401-941c-3471cf966545
[0] [Admin Check] User e5c57112-0312-4401-941c-3471cf966545 admin status: false
[0] [Admin Detection] Not admin email: session-e5c57112@temp.local for user: e5c57112-0312-4401-941c-3471cf966545
[0] [Subscription Enforcement] Valid subscription: Free tier assigned
[0] ğŸ” Checking session-based authentication...
[0] ğŸšª Logout request - IP: 10.82.1.36, User: anonymous, Session: e500ac687858009b6cc64bdad18940cb
[0] ğŸ—‘ï¸ Cleared documents for session: e500ac687858009b6cc64bdad18940cb
[0] â„¹ï¸ [SECURITY] LOGOUT | LOW | a76e1095 | User logged out successfully | /api/logout | {"userId":"anonymous","sessionId":"e500ac687858009b6cc64bdad18940cb","tokensRevoked":0,"documentsCleared":true,"hadSubscriptionToken":false}
[0] ğŸ”’ Removed session from PostgreSQL: e500ac687858009b6cc64bdad18940cb
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: e8d565aa...
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: e8d565aa...
[0] Consent verification request - IP: 10.82.1.36, UA: Mozilla/5.0 (Macinto..., User: none, Session: e8d565aa725ecf2bfd72b72335a84691
[0] Generated pseudonym 217ae41b58c3f4dfc1d64315 from identifier: session:e8d565aa725ecf2bfd72b72335a84691...
[0] Verifying consent for pseudonym: 217ae41b58c3f4dfc1d64315 (IP: 10.82.1.36, UA: Mozilla/5.0 (Macinto..., User: none, Session: e8d565aa725ecf2b)
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: e8d565aa...
[0] ğŸ” Session validation request: {
[0]   sessionId: 'none',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'missing',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking client session for unauthenticated user...
[0] âœ… Client session validation successful: e8d565aa...
[0] Consent verification result for 217ae41b58c3f4dfc1d64315: false 
[0] Consent verification response: false (session: e8d565aa725ecf2bfd72b72335a84691)
[0] ğŸ” Looking up user for email: admin@readmyfineprint.com
[0] âœ… Found user by direct email lookup
[0] [Admin Detection] Recognized known admin user ID: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Check] User c970c8a1-3a9d-43e0-b758-e5092db524ff admin status: true
[0] [Admin Access] Providing ultimate tier for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Setup] Admin user already has ultimate tier subscription
[0] [Admin Access] Returning ultimate tier (Ultimate) for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Generated verification code for admin@readmyfineprint.com (expires: 2025-08-04T08:00:18.141Z)
[0] âœ… Email sent successfully: {
[0]   messageId: '<c93dbb0d-0591-814b-d44d-3aebb9d1d30a@readmyfineprint.com>',
[0]   recipient: 'admin@readmyfineprint.com',
[0]   subject: 'ğŸ” Your ReadMyFinePrint Verification Code'
[0] }
[0] âœ… Verification email sent successfully to admin@readmyfineprint.com
[0] ğŸ“§ Verification code sent to admin@readmyfineprint.com
[2] 
[2] ğŸ” Production Health Check - 2025-08-04T07:51:40.238Z
[2] ğŸŒ Environment: staging
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] âœ… SERVER: Server responding normally
[2] âœ… DATABASE: Server responding normally
[0] âœ… Email configuration test successful
[2] âœ… EMAIL: Email service configured and ready
[2] âœ… PROCESSES: 31 server processes running
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] Overall Status: âœ… HEALTHY
[2] 
[2] ğŸ” Production Health Check - 2025-08-04T07:53:40.338Z
[2] ğŸŒ Environment: staging
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] âœ… SERVER: Server responding normally
[2] âœ… DATABASE: Server responding normally
[0] âœ… Email configuration test successful
[2] âœ… EMAIL: Email service configured and ready
[2] âœ… PROCESSES: 31 server processes running
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] Overall Status: âœ… HEALTHY
[0] âš ï¸ External services degraded: email
[0] ğŸš¨ Disaster recovery triggered: Service Degradation (Plan ID: recovery_1754294067918_xkfisf4lh)
[0] ğŸ”„ Executing recovery plan: Service Degradation
[0] ğŸ“ Step 1: Identify which external services are failing
[0] ğŸš¨ [SECURITY] SYSTEM | CRITICAL | 1ebf46cc | Disaster recovery triggered: Service Degradation | recovery-trigger | {"scenarioId":"service_degradation","planId":"recovery_1754294067918_xkfisf4lh","triggeredBy":"automated_health_check","severity":"medium"}
[0] âœ… Step 1 completed in 0s
[0] ğŸ“ Step 2: Enable graceful degradation mode
[0] âœ… Step 2 completed in 0s
[0] ğŸ“ Step 3: Display service status to users
[0] âœ… Step 3 completed in 0s
[0] ğŸ“ Step 4: Monitor for service recovery
[0] âœ… Step 4 completed in 0s
[0] ğŸ‰ Recovery plan completed successfully: Service Degradation
[0] ğŸ” [SECURITY] SYSTEM | MEDIUM | 1ebf46cc | Disaster recovery completed: Service Degradation | recovery-completion | {"planId":"recovery_1754294067918_xkfisf4lh","status":"completed","duration":513,"errors":0}
[0] âœ… Email verification cleanup completed
[0] âš ï¸ Verification attempt security mismatch for admin@readmyfineprint.com
[0] âœ… Email verification successful for admin@readmyfineprint.com
[0] ğŸ” Looking up user for email: admin@readmyfineprint.com
[0] âœ… Found user by direct email lookup
[0] [Admin Detection] Recognized known admin user ID: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Check] User c970c8a1-3a9d-43e0-b758-e5092db524ff admin status: true
[0] [Admin Access] Providing ultimate tier for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] [Admin Setup] Admin user already has ultimate tier subscription
[0] [Admin Access] Returning ultimate tier (Ultimate) for admin user: c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Generated JOSE token pair for user c970c8a1-3a9d-43e0-b758-e5092db524ff (access: 15min, refresh: 7d)
[0] â„¹ï¸ [SECURITY] AUTHENTICATION | LOW | defa994e | JOSE token pair generated | token-generation | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","secretVersion":1,"accessExpiry":"2025-08-04T08:10:17.000Z","refreshExpiry":"2025-08-11T07:55:17.000Z"}
[0] Stored session token mapping in PostgreSQL: 567ac158-e787-4eec-990f-164bd54cd08a -> eyJhbGci... (user: c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] ğŸ” Email verification login successful: {
[0]   userId: 'c970c8a1-3a9d-43e0-b758-e5092db524ff',
[0]   email: 'admin@readmyfineprint.com',
[0]   sessionId: '567ac158...',
[0]   accessTokenPrefix: 'eyJhbGciOiJIUzI1...',
[0]   cookieSettings: {
[0]     httpOnly: true,
[0]     secure: false,
[0]     sameSite: 'lax',
[0]     path: '/',
[0]     maxAge: 604800000
[0]   }
[0] }
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | fb67b495 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | fb67b495 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | fb67b495 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | fb67b495 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | fb67b495 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] â„¹ï¸ [SECURITY] USER_ACTIVITY | LOW | fb67b495 | User retrieved cookie consent preferences | /api/user/preferences/cookie-consent | {"userId":"c970c8a1-3a9d-43e0-b758-e5092db524ff","cookieConsent":null}
[0] âœ… Valid JOSE access token for user c970c8a1-3a9d-43e0-b758-e5092db524ff
[2] 
[2] ğŸ” Production Health Check - 2025-08-04T07:55:40.438Z
[2] ğŸŒ Environment: staging
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] âœ… SERVER: Server responding normally
[2] âœ… DATABASE: Server responding normally
[0] ğŸ”‘ User authenticated via secure JWT: admin@readmyfineprint.com (c970c8a1-3a9d-43e0-b758-e5092db524ff)
[0] [DEBUG] optionalUserAuth - JWT Access Token Validation: Valid=true, UserID=c970c8a1-3a9d-43e0-b758-e5092db524ff, Email=admin@readmyfineprint.com
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'present',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] âœ… JWT authentication successful for user: admin@readmyfineprint.com
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” Checking session-based authentication...
[0] ğŸ” JOSE token validation - token prefix: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...
[0] ğŸ” JOSE token validation - using secret key length: 32 bytes
[0] ğŸ” Current JWT secret version: 1
[0] âŒ JOSE token validation failed: unexpected "aud" claim value
[0] âŒ Token being validated: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
[0] âŒ Secret key details: { length: 32, keyPrefix: '2940caed' }
[0] ğŸ”„ Attempting token validation with fresh initialization...
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] âŒ Token validation failed even after re-initialization: unexpected "aud" claim value
[0] ğŸ” Session validation request: {
[0]   sessionId: '567ac158...',
[0]   clientSessionId: 'e8d565aa...',
[0]   cookies: [],
[0]   headers: {
[0]     cookie: 'present',
[0]     authorization: 'missing',
[0]     'x-session-id': 'present'
[0]   }
[0] }
[0] ğŸ” Checking authenticated user session...
[0] âœ… Email configuration test successful
[2] âœ… EMAIL: Email service configured and ready
[0] ğŸ” JOSE token validation - token prefix: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...
[0] ğŸ” JOSE token validation - using secret key length: 32 bytes
[0] ğŸ” Current JWT secret version: 1
[0] âŒ JOSE token validation failed: unexpected "aud" claim value
[0] âŒ Token being validated: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
[0] âŒ Secret key details: { length: 32, keyPrefix: '2940caed' }
[0] ğŸ”„ Attempting token validation with fresh initialization...
[2] âœ… PROCESSES: 31 server processes running
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] Overall Status: âœ… HEALTHY
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] âŒ Token validation failed even after re-initialization: unexpected "aud" claim value
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] ğŸ” Token lookup result: { found: true, tokenPrefix: 'eyJhbGciOiJIUzI1...' }
[0] ğŸ” JOSE token validation - token prefix: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...
[0] ğŸ” JOSE token validation - using secret key length: 32 bytes
[0] ğŸ” Current JWT secret version: 1
[0] âŒ JOSE token validation failed: unexpected "aud" claim value
[0] âŒ Token being validated: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
[0] âŒ Secret key details: { length: 32, keyPrefix: '2940caed' }
[0] ğŸ”„ Attempting token validation with fresh initialization...
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] âŒ Token validation failed even after re-initialization: unexpected "aud" claim value
[0] ğŸ” Token validation result: { valid: false, userId: 'none', tierId: 'none' }
[0] âŒ Token validation failed
[0] ğŸ” JOSE token validation - token prefix: eyJhbGciOiJIUzI1NiIsInR5cCI6Ik...
[0] ğŸ” JOSE token validation - using secret key length: 32 bytes
[0] ğŸ” Current JWT secret version: 1
[0] âŒ JOSE token validation failed: unexpected "aud" claim value
[0] âŒ Token being validated: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
[0] âŒ Secret key details: { length: 32, keyPrefix: '2940caed' }
[0] ğŸ”„ Attempting token validation with fresh initialization...
[0] âœ… JOSE service initialized with secret version and key length: 32 bytes
[0] âœ… JOSE token service initialized with versioned encryption key
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] âŒ Token validation failed even after re-initialization: unexpected "aud" claim value
[0] â„¹ï¸ [SECURITY] SYSTEM | LOW | 1379a641 | JOSE token service initialized with versioned secrets | initialization
[0] ğŸ§¹ Removed invalid token from database
[0] [Admin Detection] User not found: 567ac158-e787-4eec-990f-164bd54cd08a
[0] [Admin Check] User 567ac158-e787-4eec-990f-164bd54cd08a admin status: false
[0] Creating inactive free tier subscription for user: 567ac158-e787-4eec-990f-164bd54cd08a
[0] Creating inactive free tier subscription for user: 567ac158-e787-4eec-990f-164bd54cd08a
[0] User 567ac158-e787-4eec-990f-164bd54cd08a not found in database, creating user record
[0] â„¹ï¸ [SECURITY] SUBSCRIPTION_CREATED | LOW | 6adb719d | Inactive free tier subscription created for user 567ac158-e787-4eec-990f-164bd54cd08a | subscription-service | {"userId":"567ac158-e787-4eec-990f-164bd54cd08a","tierId":"free","status":"inactive"}
[0] [Admin Detection] Not admin email: session-567ac158@temp.local for user: 567ac158-e787-4eec-990f-164bd54cd08a
[0] [Subscription Enforcement] Valid subscription: Free tier assigned
[2] 
[2] ğŸ” Production Health Check - 2025-08-04T07:57:40.538Z
[2] ğŸŒ Environment: staging
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] âœ… SERVER: Server responding normally
[2] âœ… DATABASE: Server responding normally
[0] âœ… Email configuration test successful
[2] âœ… EMAIL: Email service configured and ready
[2] âœ… PROCESSES: 31 server processes running
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] Overall Status: âœ… HEALTHY
[0] âš ï¸ External services degraded: email
[0] ğŸš¨ Disaster recovery triggered: Service Degradation (Plan ID: recovery_1754294368020_58q0vmn2k)
[0] ğŸ”„ Executing recovery plan: Service Degradation
[0] ğŸ“ Step 1: Identify which external services are failing
[0] ğŸš¨ [SECURITY] SYSTEM | CRITICAL | 1ebf46cc | Disaster recovery triggered: Service Degradation | recovery-trigger | {"scenarioId":"service_degradation","planId":"recovery_1754294368020_58q0vmn2k","triggeredBy":"automated_health_check","severity":"medium"}
[0] âœ… Step 1 completed in 0s
[0] ğŸ“ Step 2: Enable graceful degradation mode
[0] âœ… Step 2 completed in 0s
[0] ğŸ“ Step 3: Display service status to users
[0] âœ… Step 3 completed in 0s
[0] ğŸ“ Step 4: Monitor for service recovery
[0] âœ… Step 4 completed in 0s
[0] ğŸ‰ Recovery plan completed successfully: Service Degradation
[0] ğŸ” [SECURITY] SYSTEM | MEDIUM | 1ebf46cc | Disaster recovery completed: Service Degradation | recovery-completion | {"planId":"recovery_1754294368020_58q0vmn2k","status":"completed","duration":259,"errors":0}
[2] 
[2] ğŸ” Production Health Check - 2025-08-04T07:59:40.638Z
[2] ğŸŒ Environment: staging
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] âœ… SERVER: Server responding normally
[2] âœ… DATABASE: Server responding normally
[0] âœ… Email configuration test successful
[2] âœ… EMAIL: Email service configured and ready
[2] âœ… PROCESSES: 31 server processes running
[2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[2] Overall Status: âœ… HEALTHY
